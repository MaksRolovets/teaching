<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–£—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
        <style>
        /* –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–ª–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –º–∏–≥–∞–Ω–∏—è */
        body { display: none; }
    </style>
    <style>
        /* styles.css */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f5f5f7;
    color: #1d1d1f;
}

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –ü–ö (—Å–≤–µ—Ä—Ö—É) */
.desktop-nav {
    display: none;
    background: white;
    border-bottom: 1px solid #e5e5e7;
    padding: 0 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 60px;
}

.logo {
    font-size: 20px;
    font-weight: bold;
    color: #0066cc;
}

.nav-links {
    display: flex;
    gap: 30px;
}

.nav-link {
    text-decoration: none;
    color: #1d1d1f;
    padding: 8px 16px;
    border-radius: 8px;
    transition: all 0.3s ease;
    font-weight: 500;
}

.nav-link:hover,
.nav-link.active {
    background: #0066cc;
    color: white;
}

.user-menu {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #0066cc;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
}

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (—Å–Ω–∏–∑—É) */
.mobile-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-top: 1px solid #e5e5e7;
    padding: 8px 0;
    display: flex;
    justify-content: space-around;
    z-index: 1000;
     transform: translateZ(0);
    -webkit-transform: translateZ(0);
    height: 65px; /* —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—ã—Å–æ—Ç—É –∏ —É–±–∏—Ä–∞–µ—Ç –ø—Ä—ã–∂–æ–∫ */
}

.mobile-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    color: #8e8e93;
    padding: 8px 12px;
    border-radius: 12px;
    transition: all 0.3s ease;
    flex: 1;
    max-width: 80px;
    
    touch-action: manipulation; /* –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —Ñ–∏–∫—Å–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ —Ç–∞–ø–æ–≤ */
}

.mobile-nav-item.active {
    color: #0066cc;
    background: rgba(0, 102, 204, 0.1);
}

.nav-icon {
    font-size: 20px;
    margin-bottom: 4px;
}

.nav-label {
    font-size: 11px;
    font-weight: 500;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
.main-content {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
    padding-bottom: 80px;
}

.page {
    display: none;
    animation: fadeIn 0.3s ease;
}

.page.active {
    display: block;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}   


.student-card {
    background: white;
    padding: 15px 20px;
    border-radius: 14px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.student-index {
    background: #0066cc;
    color: white;
    font-weight: bold;
    width: 28px;
    height: 28px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
}

.student-name {
    font-size: 16px;
    font-weight: 500;
    color: #1d1d1f;
}


.stat-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.stat-value {
    font-size: 32px;
    font-weight: bold;
    color: #0066cc;
    margin-bottom: 8px;
}

.stat-label {
    color: #8e8e93;
    font-size: 14px;
}

.sidebar {
position: fixed;
top: 0;
right: 0;
width: 350px;
height: 100%;
background: white;
box-shadow: -4px 0 12px rgba(0,0,0,0.2);
transform: translateX(100%);
transition: 0.3s;
padding: 20px;
z-index: 999;
}

.sidebar.open {
transform: translateX(0);
}

.sidebar .close-sidebar {
background: none;
border: none;
font-size: 20px;
float: right;
cursor: pointer;
}

.student-card {
cursor: pointer;
transition: 0.2s;
}
.student-card:hover {
transform: scale(1.03);
}


.section {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    margin-bottom: 20px;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (min-width: 768px) {
    .desktop-nav {
        display: block;
    }
    
    .mobile-nav {
        display: none;
    }
    
    .main-content {
        padding-top: 40px;
        min-height: calc(100vh - 60px);
    }
}

@media (max-width: 767px) {
    .main-content {
        padding-bottom: 200px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
}

.student-fields {
display: flex;
flex-direction: column;
gap: 14px;
margin-top: 20px;
}

.student-field {
background: #ffffff;
padding: 14px 16px;
border-radius: 12px;
box-shadow: 0 2px 8px rgba(0,0,0,0.05);
border: 1px solid #e5e5e5;
}

.student-field-title {
font-weight: 600;
color: #555;
margin-bottom: 4px;
font-size: 13px;
}

.student-field-value {
font-size: 15px;
color: #000;
}
/* –¢–∞–±—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è */
.schedule-tabs {
display: flex;
gap: 10px;
margin-bottom: 15px;
}

.schedule-tab {
padding: 10px 18px;
border-radius: 14px;
background: #e9eef6;
cursor: pointer;
font-size: 15px;
user-select: none;
transition: .2s;
}

.schedule-tab.active {
background: #007aff;
color: white;
}

/* –†–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.schedule-view {
display: none;
}

.floating-add-btn {
position: fixed;
bottom: 90px;
right: 25px;
width: 60px;
height: 60px;
border-radius: 50%;
background: #007aff;
color: white;
font-size: 32px;
line-height: 60px;
text-align: center;
border: none;
cursor: pointer;
box-shadow: 0 4px 12px rgba(0,0,0,0.2);
z-index: 9999; /* –≤–∞–∂–Ω–æ! */
}


.schedule-view.active {
display: block;
}

/* –î–∞—Ç–∞ */
.schedule-date {
margin: 10px 0 15px;
font-size: 16px;
font-weight: 600;
opacity: .8;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ —É—Ä–æ–∫–∞ */
/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   –ö–ê–†–¢–û–ß–ö–ò –ó–ê–ù–Ø–¢–ò–ô ‚Äî –ü–û–õ–ù–ê–Ø –®–ò–†–ò–ù–ê
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.lesson-card {
    background: white;
    border-radius: 16px;
    padding: 16px 18px;
    margin: 12px 20px;              /* –æ—Ç—Å—Ç—É–ø—ã –ø–æ –±–æ–∫–∞–º ‚Äî –∫–∞–∫ —É iPhone */
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    position: relative;
    transition: all 0.25s ease;
    min-height: 72px;
}

/* –í—Ä–µ–º—è ‚Äî —Å–ª–µ–≤–∞, –∂–∏—Ä–Ω–æ–µ */
.lesson-time {
    font-size: 18px;
    font-weight: 600;
    color: #1d1d1f;
    min-width: 115px;
    text-align: left;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—á–µ–Ω–∏–∫–µ ‚Äî –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ */
.lesson-student {
    flex: 1;
    font-size: 16px;
    color: #1d1d1f;
    margin-left: 16px;
    text-align: left;
    line-height: 1.4;
    opacity: 0.95;
}

/* –¢–æ–Ω–∫–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –∫–ª–∞—Å—Å–∞ –∏ –∑–∞–º–µ—Ç–∫–∏ ‚Äî —Å–µ—Ä—ã–º */
.lesson-student::after {
    content: attr(data-extra);
    display: block;
    font-size: 13px;
    color: #8e8e93;
    margin-top: 2px;
    font-weight: 500;
}

/* –ú–µ–Ω—é ‚ãÆ ‚Äî —Å–ø—Ä–∞–≤–∞ */
.lesson-menu {
    font-size: 22px;
    padding: 8px 4px;
    cursor: pointer;
    opacity: 0.5;
    transition: opacity 0.2s;
}

.lesson-menu:hover {
    opacity: 1;
}

/* –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é */
.lesson-dropdown {
    position: absolute;
    top: 100%;
    right: 20px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 28px rgba(0,0,0,0.18);
    min-width: 140px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: all 0.22s ease;
    z-index: 10;
    overflow: hidden;
    margin-top: 6px;
}

.lesson-dropdown.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-item {
    padding: 13px 18px;
    font-size: 15px;
    cursor: pointer;
    transition: margin-right 0.2s;
}

.dropdown-item:hover {
    background: #f5f5f7;
}

.dropdown-item.delete {
    color: #ff3b30;
}

.dropdown-item.delete:hover {
    background: #fff5f5;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (–Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ) */
@media (hover: hover) {
    .lesson-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
}
/* –ü–æ–¥–Ω—è—Ç–∞—è –∫–Ω–æ–ø–∫–∞ + –∞–Ω—Ç–∏-–ø—Ä—ã–∂–æ–∫ */


.schedule-add-btn {
position: fixed;
bottom: 90px; 
right: 25px;
width: 55px;
height: 55px;
border-radius: 50%;
background: #007aff;
color: white;
font-size: 32px;
line-height: 55px;
text-align: center;
border: none;
cursor: pointer;
box-shadow: 0 4px 15px rgba(0,0,0,.2);
z-index: 1001;  
}

/* –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ –ø–æ–¥–Ω–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã—à–µ */
@media (min-width: 768px) {
.schedule-add-btn {
    bottom: 30px;
}
}

.bottom-sheet {
position: fixed;
left: 0;
right: 0;
bottom: 0;
height: 70%; /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
background: #fff;
border-radius: 18px 18px 0 0;
transform: translateY(100%); /* –ø—Ä—è—á–µ–º –≤–Ω–∏–∑ */
transition: transform 0.25s ease-in-out; /* –±—ã—Å—Ç—Ä–æ –∏ –ø–ª–∞–≤–Ω–æ */
padding: 26px 22px 34px;
display: flex;
flex-direction: column;
overflow: hidden;
padding-bottom: calc(34px + env(safe-area-inset-bottom));
z-index: 9999;
/* overflow-y: auto; –î–æ–±–∞–≤–ª—è–µ–º: —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç —Å–∫—Ä–æ–ª–ª–∏–ª—Å—è, –µ—Å–ª–∏ –º–Ω–æ–≥–æ –ø–æ–ª–µ–π */
}  


.bottom-sheet.open {
transform: translateY(0);
}

.overlay {
position: fixed;
top: 0; left: 0; right: 0; bottom: 0;
background: rgba(0,0,0,0.4);
display: none;
z-index: 900;
transition: opacity 0.25s;
}

.overlay.show {
display: block;
opacity: 1;
}

.sheet-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
}

.sheet-title {
font-size: 18px;
font-weight: bold;
}
.bottom-sheet,
.time-scroll-modal {
    touch-action: pan-y; /* –µ—â—ë —Å–∏–ª—å–Ω–µ–µ –ø–æ–º–æ–≥–∞–µ—Ç Safari –ø–æ–Ω—è—Ç—å, —á—Ç–æ –º—ã —Å–∞–º–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç—è–Ω—É—â–∏–µ –∂–µ—Å—Ç—ã */
}

.sheet-close {
background: none;
border: none;
font-size: 20px;
cursor: pointer;
}

.sheet-content label {
display: flex;
flex-direction: column;
margin-bottom: 12px;
font-size: 14px;
}

.sheet-content input,
.sheet-content textarea,
.sheet-content select {
margin-top: 4px;
padding: 10px;
border-radius: 8px;
border: 1px solid #ddd;
font-size: 14px;
width: 100%;
}

.sheet-save-btn {
margin-top: 15px;
width: 100%;
padding: 12px;
background: #007aff;
color: white;
border: none;
border-radius: 12px;
font-size: 16px;
cursor: pointer;
}
.sheet-save-btn:active {
transform: scale(0.98);
}

.sheet-content {
display: flex;
flex-direction: column;
}

.sheet-field {
margin-bottom: 12px;
}

/* –î–û–†–ê–ë–û–¢–ö–ò –î–õ–Ø –ú–û–î–ê–õ–ö–ò –†–ê–°–ü–ò–°–ê–ù–ò–Ø */
/* –ú–æ–¥–∞–ª–∫–∞ –≤—ã–ª–µ—Ç–∞–µ—Ç —á—É—Ç—å –≤—ã—à–µ: —É–º–µ–Ω—å—à–∞–µ–º height —Å 70% –¥–æ 60% (—á—Ç–æ–±—ã –≤—ã—à–µ) */
#create-lesson-modal {
height: 100%;
}

/* –ü–æ–ª—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ—á–∫–µ: –∏—Å–ø–æ–ª—å–∑—É–µ–º flex –¥–ª—è –∏—Ö –≥—Ä—É–ø–ø—ã */
.time-fields {
display: flex;
gap: 12px;
}

.time-fields label {
flex: 1;
}

.custom-input,
.custom-select,
.custom-textarea {
appearance: none; /* –£–±–∏—Ä–∞–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω */
-webkit-appearance: none;
-moz-appearance: none;
background: #f8f8f8; /* –õ–µ–≥–∫–∏–π —Ñ–æ–Ω –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∏ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º */
border: 1px solid #ddd;
border-radius: 12px; /* –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã –∫–∞–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ */
padding: 12px 16px; /* –£–¥–æ–±–Ω—ã–π padding */
font-size: 15px;
color: #1d1d1f;
outline: none;
transition: border 0.2s ease, box-shadow 0.2s ease;
}

.custom-input:focus,
.custom-select:focus,
.custom-textarea:focus {
border-color: #007aff; /* –°–∏–Ω–∏–π –±–æ—Ä–¥–µ—Ä –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ, –∫–∞–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ */
box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2); /* –õ–µ–≥–∫–∞—è —Ç–µ–Ω—å */
}

/* –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è date/time picker –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (–¥–ª—è Chrome/Safari) */
.custom-input[type="date"]::-webkit-calendar-picker-indicator,
.custom-input[type="time"]::-webkit-calendar-picker-indicator {
opacity: 0.7; /* –°–¥–µ–ª–∞–µ–º –∏–∫–æ–Ω–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è/—á–∞—Å–æ–≤ –º–µ–Ω–µ–µ —è—Ä–∫–æ–π */
cursor: pointer;
padding: 0 10px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–æ–Ω—É –∫–ª–∏–∫–∞ */
filter: invert(0.5) sepia(1) saturate(5) hue-rotate(180deg); /* –°–∏–Ω–∏–π –æ—Ç—Ç–µ–Ω–æ–∫ –¥–ª—è –∏–∫–æ–Ω–∫–∏ */
}

/* –î–ª—è select: –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–µ–ª–∫—É –∫–∞—Å—Ç–æ–º–Ω—É—é */
.custom-select {
background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iNyIgdmlld0JveD0iMCAwIDEyIDciIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEgMUw2IDZMMTAgMSIgc3Ryb2tlPSIjOEVBRUIiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4='); /* –ö–∞—Å—Ç–æ–º–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑ (base64 SVG, —Å–∏–Ω–∏–π —Ü–≤–µ—Ç) */
background-position: right 16px center;
background-repeat: no-repeat;
background-size: 12px;
padding-right: 40px; /* –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —Å—Ç—Ä–µ–ª–∫–∏ */
}

/* –î–ª—è textarea: –¥–æ–±–∞–≤–ª—è–µ–º resize –∏ –ª–∏–º–∏—Ç –≤—ã—Å–æ—Ç—ã */
.custom-textarea {
resize: vertical; /* –ü–æ–∑–≤–æ–ª—è–µ–º —Ç—è–Ω—É—Ç—å –≤–Ω–∏–∑ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ */
min-height: 80px;
max-height: 200px;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö: —É–≤–µ–ª–∏—á–∏–º —à—Ä–∏—Ñ—Ç –∏ padding –¥–ª—è —Ç–∞—á–∞ */
@media (max-width: 767px) {
.custom-input,
.custom-select,
.custom-textarea {
    font-size: 16px; /* –ë–æ–ª—å—à–∏–π —à—Ä–∏—Ñ—Ç –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    padding: 14px 18px;
}
}
.custom-select option {
background: #fff;
color: #1d1d1f;
padding: 10px;
font-size: 15px;
}
.custom-option:hover {
background: #e9eef6; /* –õ–µ–≥–∫–∏–π —Ö–æ–≤–µ—Ä –¥–ª—è –æ–ø—Ü–∏–π */
}
/* –î–æ–±–∞–≤—å—Ç–µ/–∑–∞–º–µ–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Ü–µ <style> (–≤ head) —ç—Ç–∏ —Å—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø–æ–ª–µ–π date/time –∏ —É–ª—É—á—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ */

/* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –ø–æ–ª—è date/time */
.custom-date-time {
padding: 16px 18px !important; /* –ë–æ–ª—å—à–µ padding */
font-size: 17px !important; /* –ë–æ–ª—å—à–∏–π —à—Ä–∏—Ñ—Ç */
height: 52px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
}

/* –ö–∞—Å—Ç–æ–º–Ω–æ–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è —É—á–µ–Ω–∏–∫–∞ (–≤–º–µ—Å—Ç–æ select) */
.custom-picker {
display: flex;
align-items: center;
justify-content: space-between;
cursor: pointer;
background: #f8f8f8;
border: 1px solid #ddd;
border-radius: 12px;
padding: 14px 16px;
font-size: 16px;
color: #1d1d1f;
transition: all 0.2s ease;
}

.custom-picker:hover,
.custom-picker:focus {
border-color: #007aff;
box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);
}

.picker-arrow {
font-size: 18px;
color: #8e8e93;
}

/* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö ‚Äî –µ—â—ë –∫—Ä—É–ø–Ω–µ–µ */
@media (max-width: 767px) {
.custom-date-time {
    font-size: 18px !important;
    padding: 18px 20px !important;
    height: 56px;
}
    
.custom-picker {
    font-size: 17px;
    padding: 16px 18px;
}
}

/* –§–æ–Ω –ø–æ–¥ —Å–ø–∏—Å–∫–æ–º —É—á–µ–Ω–∏–∫–æ–≤ ‚Äî –∫–∞–∫ —É –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
.students-container {
background: #f5f5f7;
border-radius: 16px;
padding: 8px;
margin-top: 10px;
}

/* –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —É—á–µ–Ω–∏–∫–∞ */
.student-card {
background: white;
padding: 16px 20px;
border-radius: 16px;
margin-bottom: 10px;
display: flex;
align-items: center;
justify-content: space-between;
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
transition: all 0.2s ease;
cursor: pointer;
}

.student-card:hover {
transform: translateY(-2px);
box-shadow: 0 6px 16px rgba(0,0,0,0.12);
}

.student-info {
display: flex;
align-items: center;
gap: 14px;
flex: 1;
}
.lesson-info {
flex: 1;
display: flex;
flex-direction: column;
gap: 4px;
}

.lesson-time {
font-size: 18px;
font-weight: 500;
}

.lesson-student {
display: flex;
align-items: center;
gap: 8px;
font-size: 16px;
opacity: 0.9;
}

.lesson-grade {
background: #e5e5ff;
color: #5b5bff;
padding: 4px 10px;
border-radius: 10px;
font-size: 12px;
font-weight: 600;
}

/* –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é */
.lesson-card {
position: relative;
}

.lesson-dropdown {
position: absolute;
top: 100%;
right: 10px;
background: white;
border-radius: 12px;
box-shadow: 0 8px 24px rgba(0,0,0,0.15);
min-width: 140px;
opacity: 0;
visibility: hidden;
transform: translateY(-10px);
transition: all 0.2s ease;
z-index: 10;
overflow: hidden;
}

.lesson-dropdown.show {
opacity: 1;
visibility: visible;
transform: translateY(0);
}

.dropdown-item {
padding: 12px 16px;
font-size: 14px;
cursor: pointer;
transition: margin-right 0.2s;
}

.dropdown-item:hover {
background: #f5f5f7;
}

.dropdown-item.delete {
color: #ff3b30;
}

.dropdown-item.delete:hover {
background: #ffebeb;
}
.student-class {
background: #e5e5ff;
color: #5b5bff;
font-weight: 600;
font-size: 13px;
padding: 6px 12px;
border-radius: 12px;
min-width: 60px;
text-align: center;
}
.time-picker-wrapper {
margin-bottom: 16px;
}

.time-picker {
background: #f8f8f8;
border: 1px solid #ddd;
border-radius: 12px;
padding: 16px 18px;
font-size: 18px;
text-align: center;
cursor: pointer;
user-select: none;
transition: all 0.2s;
font-weight: 500;
}

.time-picker:active {
background: #e5e5e5;
}

.time-picker:focus {
outline: none;
border-color: #007aff;
box-shadow: 0 0 0 3px rgba(0,122,255,0.2);
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º –≤—Ä–µ–º–µ–Ω–∏ */
/* –ü–ò–ö–ï–† –í–†–ï–ú–ï–ù–ò ‚Äî –¢–û–ß–ù–û –ö–ê–ö –í iOS */
.time-scroll-modal {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: 340px;
    background: white;
    border-radius: 18px 18px 0 0;
    z-index: 10000;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
}

.time-scroll-modal.open {
    transform: translateY(0);
}

.time-scroll-header {
    padding: 16px;
    text-align: center;
    font-size: 17px;
    font-weight: 600;
    border-bottom: 1px solid #eee;
    position: relative;
}

.time-scroll-done {
    position: absolute;
    right: 16px;
    top: 16px;
    color: #007aff;
    font-weight: 600;
    font-size: 18px;
    background: none;
    border: none;
    padding: 8px;
    cursor: pointer;
}

.time-scroll-container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
    position: relative;
    padding: 40px 0;
}

.time-column {
    height: 180px;
    width: 80px;
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
}

.time-column::-webkit-scrollbar { display: none; }

.time-item {
    height: 44px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    color: #888;
    scroll-snap-align: center;
    user-select: none;
    transition: all 0.2s;
}

.time-item.empty { opacity: 0; pointer-events: none; }

.time-item.center {
    color: #000;
    font-weight: bold;
    font-size: 42px !important;
    transform: scale(1.15);
    line-height: 52px !important;   /* —Ç–æ—á–Ω–æ –ø–æ –≤—ã—Å–æ—Ç–µ —Ä–∞–º–∫–∏ */
}

.highlight-box {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 220px;
    height: 52px;                    /* +2px –≤—ã—Å–æ—Ç—ã */
    border: 2px solid rgba(0, 122, 255, 0.3);
    border-radius: 14px;
    pointer-events: none;
    top: 50%;
    margin-top: -30px;               /* —Ä–æ–≤–Ω–æ –ø–æ–ª–æ–≤–∏–Ω–∞ –æ—Ç 52px */
    z-index: 1;
    background: rgba(255, 255, 255, 0.6);
    /* backdrop-filter: blur(0.5px);     –ª—ë–≥–∫–æ–µ —Ä–∞–∑–º—ã—Ç–∏–µ —Ñ–æ–Ω–∞ ‚Äî –∫–∞–∫ –≤ iOS */
}

.time-option.selected {
color: #000;
font-size: 32px;
font-weight: 600;
}

.edit-icon-btn {
    position: absolute;
    top: 15px;
    right: 70px;  /* ‚Üê –î–û–ë–ê–í–ò–¢–¨: –±–∞–∑–æ–≤–æ–µ –æ—Ç–¥–∞–ª–µ–Ω–∏–µ, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ inline –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */
    font-size: 27px;  /* ‚Üê –î–û–ë–ê–í–ò–¢–¨: —á—É—Ç—å –±–æ–ª—å—à–µ –∏–∫–æ–Ω–∫–∞ */
    background: none;
    border: none;
    cursor: pointer;
    color: #000000;  /* ‚Üê –î–û–ë–ê–í–ò–¢–¨: —Å–∏–Ω–∏–π —Ü–≤–µ—Ç, –∫–∞–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ */
    transition: transform 0.2s;  /* ‚Üê –î–û–ë–ê–í–ò–¢–¨: –∞–Ω–∏–º–∞—Ü–∏—è */
}

.edit-icon-btn:hover {
    transform: scale(1.2);  /* ‚Üê –î–û–ë–ê–í–ò–¢–¨: —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏ hover */
    color: #005bb5;  /* –¢–µ–º–Ω–µ–µ –ø—Ä–∏ hover */
}
/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è */
.delete-btn {
    margin-top: 20px;
    width: 100%;
    padding: 12px;
    background: #ff3b30; /* –ö—Ä–∞—Å–Ω—ã–π, –∫–∞–∫ –≤ iOS –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è */
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    transition: transition 0.2s, transform 0.1s;
}
.time-scroll-container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
    position: relative;
    padding: 0;
    height: 260px;
}

.highlight-box {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 50px;
    border: 2px solid rgba(30, 114, 255, 0.3);
    border-radius: 12px;
    pointer-events: none;
    top: 105px; /* —Ç–æ—á–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
    z-index: 1;
}
.delete-btn:hover {
    background: #d32f2a; /* –¢–µ–º–Ω–µ–µ –ø—Ä–∏ hover */
}

.delete-btn:active {
    transform: scale(0.98); /* –õ—ë–≥–∫–∏–π "–Ω–∞–∂–∞—Ç–∏–µ" */
}

/* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—Ç–∏–ª–µ–π –¥–ª—è –Ω–µ–¥–µ–ª—å–Ω–æ–π —Å–µ—Ç–∫–∏ (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –µ–¥–∏–Ω—Å—Ç–≤–∞ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º) */
.top-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.dropdown {
    position: relative;
    width: 160px;
}

.dropdown-button {
    background: #fff;
    padding: 8px 10px;
    border-radius: 12px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.15);
    cursor: pointer;
    font-weight: 600;
    border: 1px solid #e5e5ea;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.dropdown-menu {
    position: absolute;
    top: 110%;
    left: 0;
    width: 100%;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    padding: 8px 0;
    display: none;
    max-height: 260px;
    overflow-y: auto;
    z-index: 1000;
}

.dropdown-item {
    padding: 10px 16px;
    cursor: pointer;
}

.dropdown-item:hover {
    background: #f2f2f7;
}

.btn {
    padding: 10px 12px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    white-space: nowrap;
}
.btn.gray { background:#d1d1d6; color:#000; }
.btn.green { background:#34c759; color:#fff; }

.week-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 12px;
}
@media (max-width: 768px) {
    .week-grid { grid-template-columns: 1fr; }
}

.day-col {
    background: #fff;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.day-header {
    font-weight: bold;
    text-align: center;
    margin-bottom: 10px;
}

.empty-day {
    color: #888;
    text-align: center;
    font-style: italic;
}

.week-lesson-card {
    background: #f8f8f8;
    border-radius: 8px;
    padding: 8px 12px;
    margin-bottom: 8px;
    font-size: 14px;
}

.week-lesson-time {
    font-weight: 500;
}

.week-lesson-student {
    opacity: 0.8;
}

/* –î–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ */
.custom-date-time[type="date"] {
    padding: 20px 24px !important; /* –ï—â—ë –±–æ–ª—å—à–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    font-size: 20px !important; /* –ë–æ–ª—å—à–∏–π —à—Ä–∏—Ñ—Ç –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
    height: 60px; /* –í—ã—à–µ –ø–æ–ª–µ */
}

.custom-date-time[type="date"]::-webkit-calendar-picker-indicator {
    padding: 0 20px; /* –ü–æ–¥–≤–∏–Ω—É—Ç—å –∏–∫–æ–Ω–∫—É –≤–ø—Ä–∞–≤–æ, —É–≤–µ–ª–∏—á–∏—Ç—å –∑–æ–Ω—É –∫–ª–∏–∫–∞ */
    transform: scale(1.2); /* –°–¥–µ–ª–∞—Ç—å –∏–∫–æ–Ω–∫—É –±–æ–ª—å—à–µ */
}

@media (max-width: 767px) {
    .custom-date-time[type="date"] {
        font-size: 22px !important;
        padding: 22px 26px !important;
        height: 64px;
    }
}
/* –ò–î–ï–ê–õ–¨–ù–´–ô –ü–ò–ö–ï–† –í–†–ï–ú–ï–ù–ò */
.hours-list, .minutes-list {
    height: 260px;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: y mandatory;
    padding: 100px 0; /* –ú–Ω–æ–≥–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ —Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É */
    background: linear-gradient(to bottom, transparent 0%, #f8f8f8 15%, #f8f8f8 85%, transparent 100%);
}



.time-option.empty {
    height: 50px;
    pointer-events: none;
}
/* –ü–ò–ö–ï–† –í–†–ï–ú–ï–ù–ò ‚Äî –ö–†–ê–°–ò–í–û –ò –†–ê–ë–û–ß–ï */
.hours-list, .minutes-list {
    height: 260px;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: y mandatory;
    padding: 100px 0;
    background: #f8f8f8;
}

.time-spacer {
    height: 50px;
    pointer-events: none;
}

.time-option {
    height: 50px;
    line-height: 50px;
    text-align: center;
    font-size: 20px;
    color: #888;
    scroll-snap-align: center;
    user-select: none;
    cursor: pointer;
}

.time-option.selected {
    font-size: 36px !important;
    font-weight: 600;
    color: #000 !important;
}
.time-scroll-container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
    position: relative;
    padding: 60px 0; /* —É–≤–µ–ª–∏—á–∏–ª ‚Äî —Ç–µ–ø–µ—Ä—å —Ç–æ—á–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
}
/* === –ò–î–ï–ê–õ–¨–ù–´–ô –ü–ò–ö–ï–† –í–†–ï–ú–ï–ù–ò (iOS-style) === */
.mobile-time-picker {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: white; border-radius: 20px 20px 0 0;
    box-shadow: 0 -10px 40px rgba(0,0,0,0.25);
    z-index: 10000; transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.25,0.8,0.25,1);
    overflow: hidden;
}
.mobile-time-picker.open { transform: translateY(0); }

.tp-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: #f9f9f9; border-bottom: 1px solid #ddd; }
.tp-btn { border: none; background: none; padding: 8px 16px; border-radius: 12px; font-weight: 600; font-size: 17px; cursor: pointer; }
.tp-btn.cancel { color: #007aff; }
.tp-btn.done { background: #007aff; color: white; }

.tp-content { position: relative; height: 280px; display: flex; align-items: center; justify-content: center; background: #fdfdfd; }
.tp-column { width: 100px; height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
.tp-column::-webkit-scrollbar { display: none; }
.tp-column div { height: 56px; line-height: 56px; text-align: center; font-size: 28px; color: #aaa; scroll-snap-align: center; user-select: none; transition: all 0.2s; }
.tp-column .selected { color: #000 !important; font-weight: 800 !important; font-size: 42px !important; }
.tp-colon { font-size: 42px; font-weight: bold; margin: 0 16px; color: #000; }
.tp-center-line { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 240px; height: 56px; border: 2.5px solid #007aff; border-radius: 12px; pointer-events: none; box-shadow: 0 0 20px rgba(0,123,255,0.25); z-index: 10; }
.tp-mask { position: absolute; left: 0; right: 0; height: 100px; pointer-events: none; z-index: 5; }
.tp-mask.top { top: 0; background: linear-gradient(to bottom, white 30%, transparent); }
.tp-mask.bottom { bottom: 0; background: linear-gradient(to top, white 30%, transparent); }

body.picker-open { overflow: hidden; position: fixed; width: 100%; }
/* –ö–ù–û–ü–ö–ê –°–ï–ì–û–î–ù–Ø –í –°–ü–ò–°–ö–ï –†–ê–°–ü–ò–°–ê–ù–ò–Ø */
.schedule-today-btn {
    position: sticky;
    top: 0;
    background: white;
    padding: 12px 20px;
    text-align: center;
    border-bottom: 1px solid #e5e5e5;
    font-weight: 600;
    color: #007aff;
    z-index: 10;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

/* –í—ã–¥–µ–ª–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è */
.today-header {
    position: relative;
    padding: 16px 0 12px !important;
    font-weight: 700 !important;
    color: #007aff !important;
}

.today-header::before,
.today-header::after {
    content: '';
    position: absolute;
    left: 0; right: 0;
    height: 2px;
    background: #007aff;
}

.today-header::before { top: 0; }
.today-header::after { bottom: 0; }

/* –ü—Ä–æ—à–µ–¥—à–∏–µ –¥–Ω–∏ ‚Äî —Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç */
.past-date {
    color: #8e8e93 !important;
    opacity: 0.8;
}
/* –ö–ù–û–ü–ö–ê –°–ï–ì–û–î–ù–Ø */
.schedule-today-btn {
    position: sticky;
    top: 0;
    background: white;
    padding: 14px 20px;
    text-align: center;
    font-weight: 600;
    color: #007aff;
    z-index: 10;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    cursor: pointer;
    border-bottom: 1px solid #e5e5e5;
    user-select: none;
    transition: background 0.2s;
}
.schedule-today-btn:active {
    background: #f2f2f7;
}

/* –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –£–†–û–ö–û–í */
#lessons-container {
    padding: 0 12px 20px;
}

/* –ù–û–í–´–ï –ö–ê–†–¢–û–ß–ö–ò –£–†–û–ö–û–í ‚Äî –¢–í–û–Ø –í–ï–†–°–ò–Ø */
.lesson-card-new {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #ffffff;
    padding: 18px 22px;
    margin: 14px 8px;
    border-radius: 18px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    transition: all 0.2s ease;
    position: relative;
}

.lesson-card-new:active {
    transform: scale(0.98);
}

.lesson-card-new.past {
    opacity: 0.55;
}

.lesson-card-new.today {
    border: 2px solid #34c759;
    background: #f9fff9;
}

.lesson-main {
    display: flex;
    align-items: center;
    gap: 14px;
    flex-wrap: wrap;
    flex: 1;
}

.lesson-time {
    font-size: 18px;
    font-weight: 600;
    color: #000;
    min-width: 110px;
}

.lesson-name {
    font-size: 16.5px;
    font-weight: 500;
    color: #222;
}

.lesson-grade {
    background: #e8f0fe;
    color: #3b6dd8;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
}

.lesson-actions {
    position: relative;
    margin-left: 10px;
}

.lesson-menu {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    padding: 6px 8px;
    border-radius: 12px;
    color: #888;
    transition: all 0.2s;
}

.lesson-menu:hover {
    background: rgba(0,0,0,0.08);
    color: #000;
}

.lesson-dropdown {
    display: none;
    position: absolute;
    right: 0;
    top: 36px;
    background: white;
    border-radius: 14px;
    box-shadow: 0 8px 28px rgba(0,0,0,0.18);
    overflow: hidden;
    z-index: 20;
    min-width: 160px;
    animation: fadeIn 0.18s ease;
}

.lesson-dropdown.show {
    display: block;
}

.dropdown-item {
    padding: 14px 20px;
    font-size: 15px;
    cursor: pointer;
    color: #333;
    transition: background 0.2s;
}

.dropdown-item:hover {
    background: #f5f5f7;
}

.dropdown-item.delete {
    color: #ff3b30;
}

.dropdown-item.delete:hover {
    background: #fff5f5;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-6px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∞—Ç—ã */
.schedule-date-new {
    padding: 20px 20px 8px;
    font-size: 17px;
    font-weight: 600;
    color: #333;
    position: sticky;
    top: 58px; /* –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π "–°–µ–≥–æ–¥–Ω—è" */
    background: #f4f4f7;
    z-index: 9;
}

.schedule-date-new.today {
    color: #34c759;
    font-weight: 700;
}

.schedule-date-new.past {
    color: #999;
}
/* –ü–†–ò–õ–ò–ü–ê–Æ–©–ò–ô –•–ï–î–ï–† */
.schedule-header-sticky {
    position: sticky;
    top: 0;
    background: #f5f5f7;
    z-index: 100;
    padding: 12px 16px 0;
    border-bottom: 1px solid #d2d2d7;
    display: flex;
    justify-content: space-between;
    align-items: center;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

/* –¢–∞–±—ã ‚Äî —á—É—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –∏ –∫—Ä–∞—Å–∏–≤–µ–µ */
.schedule-tabs {
    display: flex;
    gap: 8px;
    background: #e5e5ea;
    padding: 4px;
    border-radius: 12px;
    width: fit-content;
}

.schedule-tab {
    padding: 8px 16px;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    user-select: none;
    transition: all 0.25s ease;
    color: #666;
}

.schedule-tab.active {
    background: #007aff;
    color: white;
}

/* –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –ö–ù–û–ü–ö–ê "–°–ï–ì–û–î–ù–Ø" ‚Äî –∫–∞–∫ –≤ iOS Calendar */
.today-btn-compact {
    background: none;
    border: none;
    font-size: 15px;
    font-weight: 600;
    color: #007aff;
    padding: 8px 14px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.today-btn-compact:active {
    background: rgba(0, 122, 255, 0.1);
    transform: scale(0.96);
}

.today-btn-compact.has-lessons {
    background: #007aff;
    color: white;
}

.today-btn-compact.no-lessons {
    color: #999;
    cursor: default;
}

.today-btn-compact.no-lessons:active {
    transform: none;
    background: none;
}

/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–∞—Ç ‚Äî —Ç–µ–ø–µ—Ä—å –ø–æ–¥ –ø—Ä–∏–ª–∏–ø–∞—é—â–∏–º —Ö–µ–¥–µ—Ä–æ–º */
.schedule-date-new {
    padding: 20px 20px 8px;
    font-size: 17px;
    font-weight: 600;
    color: #333;
    position: sticky;
    top: 68px; /* –ø–æ–¥ —Ö–µ–¥–µ—Ä–æ–º */
    background: #f5f5f7;
    z-index: 9;
    margin: 0;
}
/* –§–∏–∫—Å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–µ–≥–æ–¥–Ω—è" –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö: –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫ + –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑ */
@media (max-width: 767px) {
    .schedule-header-sticky {
        flex-direction: column; /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫ –≤–º–µ—Å—Ç–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ */
        gap: 12px; /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–∞–±–∞–º–∏ –∏ –∫–Ω–æ–ø–∫–æ–π */
        padding: 12px 16px 16px; /* –ù–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ padding —Å–Ω–∏–∑—É –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
        align-items: stretch; /* –¢–∞–±—ã —Ä–∞—Å—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
    }
    
    .schedule-tabs {
        order: 1; /* –¢–∞–±—ã —Å–≤–µ—Ä—Ö—É */
        width: 100%; /* –ü–æ–ª–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–∏–¥–∞ */
        justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ç–∞–±—ã */
    }
    
    .today-btn-compact {
        order: 2; /* –ö–Ω–æ–ø–∫–∞ —Å–Ω–∏–∑—É */
        align-self: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É */
        padding: 10px 16px; /* –ß—É—Ç—å –±–æ–ª—å—à–µ padding –¥–ª—è —Ç–∞—á–∞ */
        font-size: 16px; /* –ë–æ–ª—å—à–∏–π —à—Ä–∏—Ñ—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        min-width: 120px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞, —á—Ç–æ–±—ã –Ω–µ —Å–∂–∏–º–∞–ª–∞—Å—å */
    }
    
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –µ—Å–ª–∏ —Ç–∞–±—ã —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ, —Å–∫—Ä–æ–ª–ª –∏—Ö –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ */
    .schedule-tabs {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –≤ Firefox */
    }
    
    .schedule-tabs::-webkit-scrollbar {
        display: none; /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –≤ Chrome/Safari */
    }
}
@media (max-width: 767px) {
    .bottom-sheet {
        height: 92%;
    }
}
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –ü–ö (—Å–≤–µ—Ä—Ö—É) -->
    <nav class="desktop-nav">
        <div class="nav-container">
            <div class="logo">–£—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
            
            <div class="nav-links">
                <a href="#" class="nav-link active" data-page="dashboard">üìä –î–∞—à–±–æ—Ä–¥</a>
                <a href="#" class="nav-link" data-page="students">üë®‚Äçüéì –£—á–µ–Ω–∏–∫–∏</a>
                <!-- <a href="#" class="nav-link" data-page="lessons">üìö –ó–∞–Ω—è—Ç–∏—è</a> -->
                <a href="#" class="nav-link" data-page="schedule">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
                <a href="#" class="nav-link" data-page="reports">üìà –û—Ç—á–µ—Ç—ã</a>
            </div>
            
            <div class="user-menu">
                <div class="user-avatar">–ò–ò</div>
                <a href="#" id="logout" class="nav-link">üö™ –í—ã—Ö–æ–¥</a>
            </div>
        </div>
    </nav>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="main-content">
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –î–∞—à–±–æ—Ä–¥ -->
        <div id="dashboard" class="page active">
            <div class="dashboard-header">
                <h1>–î–∞—à–±–æ—Ä–¥</h1>
                <a href="#" id="mobile-logout" class="nav-link">üö™ –í—ã—Ö–æ–¥</a>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">24</div>
                    <div class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">156</div>
                    <div class="stat-label">–ó–∞–Ω—è—Ç–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">92%</div>
                    <div class="stat-label">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">284,500 ‚ÇΩ</div>
                    <div class="stat-label">–î–æ—Ö–æ–¥</div>
                </div>
            </div>
            
            <div class="section">
                <h2 style="margin-bottom: 15px;">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
                <p>–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ –∑–∞–≤–µ—Ä—à–∏–ª –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</p>
                <p>–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞ –∑–∞–ø–∏—Å–∞–ª–∞—Å—å –Ω–∞ –Ω–æ–≤–æ–µ –∑–∞–Ω—è—Ç–∏–µ</p>
                <p>–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤ –ø—Ä–æ–¥–ª–∏–ª –∞–±–æ–Ω–µ–º–µ–Ω—Ç</p>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –£—á–µ–Ω–∏–∫–∏ -->
        <div id="students" class="page">
            <h1 style="margin-bottom: 20px;">–£—á–µ–Ω–∏–∫–∏</h1>
            <div class="students-container">
                <div id="students-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
    </div>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ó–∞–Ω—è—Ç–∏—è -->
    <div id="lessons" class="page">
        <h1 style="margin-bottom: 20px;">–ó–∞–Ω—è—Ç–∏—è</h1>
        <div class="section">
            <p>–°–ø–∏—Å–æ–∫ –∑–∞–Ω—è—Ç–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å...</p>
        </div>
    </div>
    
<!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
<div id="schedule" class="page">
    <h1 style="margin-bottom: 20px;">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h1>
    
    <!-- –¢–∞–±—ã –∏ –∫–Ω–æ–ø–∫–∞ "–°–µ–≥–æ–¥–Ω—è" (sticky-—Ö–µ–¥–µ—Ä) -->
    <div class="schedule-header-sticky">
        <div id="schedule-tabs-container" class="schedule-tabs">
            <div class="schedule-tab active" data-mode="list">–°–ø–∏—Å–æ–∫</div>
            <div class="schedule-tab" data-mode="table">–¢–∞–±–ª–∏—Ü–∞</div>
            <div class="schedule-tab" data-mode="calendar">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</div>
        </div>

        <button id="today-btn" class="today-btn-compact" onclick="handleTodayButton()">
            –°–µ–≥–æ–¥–Ω—è
        </button>
    </div>

    <!-- –†–µ–∂–∏–º –°–ø–∏—Å–æ–∫ -->
    <div id="schedule-list-view" class="schedule-view active">
        <div id="lessons-container">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>
    </div>
        
    <div id="schedule-table-view" class="schedule-view">
        <!-- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ–¥–µ–ª—å–Ω–æ–π —Å–µ—Ç–∫–∏ –≤–º–µ—Å—Ç–æ –∑–∞–≥–ª—É—à–∫–∏ -->
        <div class="top-controls">
            <button class="btn gray" onclick="prevWeek()">‚Üê –ü—Ä–µ–¥</button>

            <!-- Dropdown -->
            <div class="dropdown">
                <div class="dropdown-button" onclick="toggleDropdown()" id="dropdown-label">
                    –í—ã–±—Ä–∞—Ç—å –Ω–µ–¥–µ–ª—é
                </div>
                <div class="dropdown-menu" id="dropdown-menu"></div>
            </div>

            <button class="btn gray" onclick="nextWeek()">–°–ª–µ–¥ ‚Üí</button>
            <!-- –ó–µ–ª—ë–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–°–µ–≥–æ–¥–Ω—è" —É–¥–∞–ª–µ–Ω–∞ ‚Äî —Ç–µ–ø–µ—Ä—å –æ–Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –≤ sticky-—Ö–µ–¥–µ—Ä–µ -->
        </div>

        <div id="week-grid" class="week-grid"></div>
    </div>
    
    <div id="schedule-calendar-view" class="schedule-view">
        <p style="opacity: .6; margin-top: 20px;">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å (–ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏–º)</p>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å -->
</div>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –û—Ç—á–µ—Ç—ã -->
    <div id="reports" class="page">
        <h1 style="margin-bottom: 20px;">–û—Ç—á–µ—Ç—ã</h1>
        <div class="section">
            <p>–û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å...</p>
        </div>
    </div>
    
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —É—á–µ–Ω–∏–∫–∞ -->
    <div id="student-sidebar" class="sidebar closed">
<div class="sidebar-content">
<button class="close-sidebar">‚úñ</button>


<!-- Edit Button -->
<button id="sidebar-edit-btn" class="edit-icon-btn">‚úé</button>


<h2 id="sidebar-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>


<div class="student-fields">


<div class="student-field">
<div class="student-field-title">–ö–ª–∞—Å—Å</div>
<div class="student-field-value" id="sidebar-age"></div>
</div>


<div class="student-field">
<div class="student-field-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
<div class="student-field-value" id="sidebar-info"></div>
</div>


<div class="student-field">
<div class="student-field-title">–ö–æ–Ω—Ç–∞–∫—Ç</div>
<div class="student-field-value" id="sidebar-phone"></div>
</div>


<!-- Edit Buttons (hidden until edit mode) -->
<div id="edit-buttons" style="display:none; margin-top:20px; gap:10px;">
<button id="edit-save-btn" style="padding:8px 16px; background:#4caf50; color:white; border:none; border-radius:6px; cursor:pointer;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
<button id="edit-cancel-btn" style="padding:8px 16px; background:#ccc; border:none; border-radius:6px; cursor:pointer;">–û—Ç–º–µ–Ω–∞</button>
</div>
<button id="delete-student-btn" class="delete-btn">–£–¥–∞–ª–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>

</div>
</div>
</div>
    
    
</main>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (—Å–Ω–∏–∑—É) -->
<nav class="mobile-nav">
    <a href="#" class="mobile-nav-item active" data-page="dashboard">
        <div class="nav-icon">üìä</div>
        <div class="nav-label">–ì–ª–∞–≤–Ω–∞—è</div>
    </a>
    <a href="#" class="mobile-nav-item" data-page="students">
        <div class="nav-icon">üë®‚Äçüéì</div>
        <div class="nav-label">–£—á–µ–Ω–∏–∫–∏</div>
        
    </a>
    <!-- <a href="#" class="mobile-nav-item" data-page="lessons">
        <div class="nav-icon">üìö</div>
            <div class="nav-label">–ó–∞–Ω—è—Ç–∏—è</div>
        </a> -->
        <a href="#" class="mobile-nav-item" data-page="schedule">
            <div class="nav-icon">üìÖ</div>
            <div class="nav-label">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
        </a>
        <a href="#" class="mobile-nav-item" data-page="reports">
            <div class="nav-icon">üìà</div>
            <div class="nav-label">–û—Ç—á–µ—Ç—ã</div>
        </a>
        <!-- <button id="schedule-add-btn" class="schedule-add-btn">+</button> -->
         
    </nav>
    <div id="overlay" class="overlay"></div>
    <div id="create-student-modal" class="bottom-sheet">
    <div class="sheet-header">
        <div class="sheet-title">–ù–æ–≤—ã–π —É—á–µ–Ω–∏–∫</div>
        <button class="sheet-close">‚úñ</button>
    </div>

    <div class="sheet-content">
        <label class="sheet-field">
            <span>–ò–º—è —É—á–µ–Ω–∏–∫–∞</span>
            <input type="text" id="student-name-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
        </label>

        <label class="sheet-field">
            <span>–ö–ª–∞—Å—Å</span>
            <input type="number" id="student-age-input" placeholder="–ö–ª–∞—Å—Å —É—á–µ–Ω–∏–∫–∞">
        </label>

        <label class="sheet-field">
            <span>–ö–æ–Ω—Ç–∞–∫—Ç</span>
            <input type="text" id="student-phone-input" placeholder="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">
        </label>

        <label class="sheet-field">
            <span>–û–ø–∏—Å–∞–Ω–∏–µ</span>
            <textarea id="student-info-input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
        </label>

        <button id="create-student-btn" class="sheet-save-btn">
            –°–æ–∑–¥–∞—Ç—å —É—á–µ–Ω–∏–∫–∞
        </button>
    </div>
</div>
<div id="create-lesson-modal" class="bottom-sheet">
    <div class="sheet-header">
        <div class="sheet-title">–ù–æ–≤–æ–µ –∑–∞–Ω—è—Ç–∏–µ</div>
        <button class="sheet-close">‚úñ</button>
    </div>

    <div class="sheet-content">
        <label class="sheet-field">
            <span>–£—á–µ–Ω–∏–∫</span>
            <div id="lesson-student-picker" class="custom-input custom-picker">
                <span id="lesson-student-display">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞</span>
                <span class="picker-arrow">‚Üí</span>
            </div>
            <input type="hidden" id="lesson-student-id">
            <input type="hidden" id="lesson-student-name">
        </label>

       <label class="sheet-field">
    <span>–î–∞—Ç–∞ –∑–∞–Ω—è—Ç–∏—è</span>
    <input type="date" id="lesson-date" class="custom-input custom-date-time" required>
</label>

<div class="time-fields">
    <label class="sheet-field">
        <span>–ù–∞—á–∞–ª–æ</span>
        <div id="lesson-start-picker" class="time-picker">12:00</div>
        <input type="hidden" id="lesson-start-input">
    </label>
    <label class="sheet-field">
        <span>–ö–æ–Ω–µ—Ü</span>
        <div id="lesson-end-picker" class="time-picker">13:00</div>
        <input type="hidden" id="lesson-end-input">
    </label>
</div>

<label class="sheet-field">
    <span>–ó–∞–º–µ—Ç–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span>
    <input type="text" id="lesson-notes" class="custom-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –≥–ª–∞–≥–æ–ª–æ–≤">
</label>
        <label class="sheet-field">
            <input type="checkbox" id="lesson-recurring">
            <span style="margin-left:8px; font-size:15px;">–ü–æ–≤—Ç–æ—Ä—è—Ç—å –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</span>
        </label>
        <label class="sheet-field" id="recurring-weeks-field" style="display: none; margin-top: 10px;">
    <span>–ù–∞ —Å–∫–æ–ª—å–∫–æ –Ω–µ–¥–µ–ª—å</span>
    <input type="number" id="lesson-recurring-weeks" min="1" max="52" value="4" style="width: 60px; text-align: center;">
</label>
        <button id="create-lesson-btn" class="sheet-save-btn">
            –°–æ–∑–¥–∞—Ç—å –∑–∞–Ω—è—Ç–∏–µ
        </button>
    </div>
</div>

<div id="mobile-time-picker" class="mobile-time-picker">
    <div class="tp-header">
        <button class="tp-btn cancel">–û—Ç–º–µ–Ω–∞</button>
        <div style="font-weight:600;">–í—Ä–µ–º—è</div>
        <button class="tp-btn done">–ì–æ—Ç–æ–≤–æ</button>
    </div>
    <div class="tp-content">
        <div class="tp-column" id="tp-hours"></div>
        <div class="tp-colon">:</div>
        <div class="tp-column" id="tp-minutes"></div>
        <div class="tp-mask top"></div>
        <div class="tp-mask bottom"></div>
        <div class="tp-center-line"></div>
    </div>
</div>
<div id="edit-lesson-modal" class="bottom-sheet">
    <div class="sheet-header">
        <div class="sheet-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω—è—Ç–∏–µ</div>
        <button class="sheet-close">‚úñ</button>
    </div>

    <div class="sheet-content">
        <label class="sheet-field">
    <span>–£—á–µ–Ω–∏–∫</span>
    <div id="edit-lesson-student-display" class="custom-input" style="cursor: default; background: #f8f8f8; pointer-events: none;">
        <!-- –¢–µ–∫—Å—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è JS'–æ–º, –±–µ–∑ —Å—Ç—Ä–µ–ª–∫–∏ –∏ –∫–ª–∏–∫–∞ -->
    </div>
    <input type="hidden" id="edit-lesson-student-id">
</label>

        <label class="sheet-field">
            <span>–î–∞—Ç–∞ –∑–∞–Ω—è—Ç–∏—è</span>
            <input type="date" id="edit-lesson-date" class="custom-input custom-date-time" required>
        </label>

        <div class="time-fields">
            <label class="sheet-field">
                <span>–ù–∞—á–∞–ª–æ</span>
                <div id="edit-lesson-start-picker" class="time-picker">12:00</div>
                <input type="hidden" id="edit-lesson-start-input">
            </label>
            <label class="sheet-field">
                <span>–ö–æ–Ω–µ—Ü</span>
                <div id="edit-lesson-end-picker" class="time-picker">13:00</div>
                <input type="hidden" id="edit-lesson-end-input">
            </label>
        </div>
        
        <label class="sheet-field">
            <span>–ó–∞–º–µ—Ç–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span>
            <input type="text" id="edit-lesson-notes" class="custom-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –≥–ª–∞–≥–æ–ª–æ–≤">
        </label>
        
        <label class="sheet-field">
            <input type="checkbox" id="edit-lesson-recurring">
            <span style="margin-left:8px; font-size:15px;">–ü–æ–≤—Ç–æ—Ä—è—Ç—å –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</span>
        </label>
        
        <button id="edit-lesson-btn" class="sheet-save-btn">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        </button>
    </div>
</div>

<style>
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .dashboard-header h1 {
        margin-bottom: 0;
    }

    @media (min-width: 769px) {
        #mobile-logout {
            display: none;
        }
    }

    @media (max-width: 768px) {
        #logout {
            display: none;
        }
    }
</style>
</body>
<script>

const API = "https://repetitor-web-app.cloudpub.ru"


// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access —Ç–æ–∫–µ–Ω–∞
let refreshPromise = null;

async function refreshAccessToken() {
    if (refreshPromise) {
        return refreshPromise;
    }

    refreshPromise = (async () => {
        const res = await fetch(API + '/auth/refresh', {
            method: 'POST',
            credentials: 'include',
        });

        if (!res.ok) {
            localStorage.removeItem('accessToken');
            window.location.href = '/home';
            throw new Error('Refresh token expired');
        }

        const data = await res.json();
        localStorage.setItem('accessToken', data.access_token);
        return data.access_token;
    })();

    try {
        return await refreshPromise;
    } finally {
        refreshPromise = null;
    }
}


// –û—Å–Ω–æ–≤–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è fetch —Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞
async function apiClient(endpoint, options = {}, retry = true) {
    const headers = {
        'Content-Type': 'application/json',
        ...options.headers,
    };

    const token = localStorage.getItem('accessToken');
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }

    const response = await fetch(API + endpoint, {
        ...options,
        headers,
        credentials: 'include',
    });

    if (response.status === 401 && retry) {
        await refreshAccessToken();
        return apiClient(endpoint, options, false);
    }

    return response;
}

(async () => {
    const accessToken = localStorage.getItem('accessToken');
    
    if (!accessToken) {
        window.location.href = '/home';
        return;
    }

    try {
        await refreshAccessToken();  // –ï—Å–ª–∏ fail, —Ñ—É–Ω–∫—Ü–∏—è —Å–∞–º–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç
    } catch (err) {
        return;  // –†–µ–¥–∏—Ä–µ–∫—Ç —É–∂–µ —Å—Ä–∞–±–æ—Ç–∞–ª –≤–Ω—É—Ç—Ä–∏
    }

    // –ï—Å–ª–∏ —É—Å–ø–µ—Ö ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    document.body.style.display = 'block';
    await loadData();
    await loadDashboardData(); 
    await loadSchedule();  // –ñ–¥—ë–º, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –≥–æ—Ç–æ–≤—ã
    cachedLessonsByDate = null;  // –°–±—Ä–æ—Å –∫—ç—à–∞ —è–≤–Ω–æ
    updateTodayButtonState();
    // –ï—Å–ª–∏ –¥–∞—à–±–æ—Ä–¥ –Ω—É–∂–µ–Ω —Å—Ä–∞–∑—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–µ–Ω)
})();

async function handleLogout() {
        const accessToken = localStorage.getItem('accessToken');
        const refreshToken = localStorage.getItem('refreshToken');

        try {
            const response = await fetch('/auth/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${accessToken}`
                }
            });

            if (!response.ok) {
                console.error('Logout API failed:', response.status);
            }
        } catch (error) {
            console.error('Error during logout:', error);
        } finally {
            // Always clear tokens and redirect, even if API fails
            clearTokens();
            redirectToLogin();
        }
    }

    function clearTokens() {
        localStorage.removeItem('accessToken');
    }

    function redirectToLogin() {
        window.location.href = '/home'; 
    }

    // Add event listeners
    document.getElementById('logout').addEventListener('click', (e) => {
        e.preventDefault();
        handleLogout();
    });

    document.getElementById('mobile-logout').addEventListener('click', (e) => {
        e.preventDefault();
        handleLogout();
    });

let sidebarWasOpen = false;
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–≥—Ä—É–∑–∫–∏ schedule (–∞–≤—Ç–æ-—Å–∫—Ä–æ–ª–ª –∫ "—Å–µ–≥–æ–¥–Ω—è")
let firstScheduleLoad = true;   
let selectingStudentForEdit = false;
// –õ–æ–≥–∏–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
class Navigation {
    constructor() {
        this.currentPage = 'dashboard';
        this.init();
    }
    
    init() {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–≥–æ –º–µ–Ω—é
        const desktopLinks = document.querySelectorAll('.desktop-nav .nav-link');
        desktopLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                this.navigateTo(link.dataset.page);
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é
        const mobileLinks = document.querySelectorAll('.mobile-nav-item');
        mobileLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                this.navigateTo(link.dataset.page);
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', this.handleResize.bind(this));
    }
    
   navigateTo(pageId) {
// *** –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ —É—Ö–æ–¥–æ–º ***
localStorage.setItem(`scroll_${this.currentPage}`, window.scrollY);

// –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
const currentPage = document.getElementById(this.currentPage);
if (currentPage) {
    currentPage.classList.remove('active');
}

// –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫
document.querySelectorAll('.nav-link.active, .mobile-nav-item.active').forEach(item => {
    item.classList.remove('active');
});

// –í–°–ï–ì–î–ê —É–¥–∞–ª—è–µ–º –∫–Ω–æ–ø–∫—É "+" –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π
removeFloatingAddButton();

// –ó–∞–∫—Ä—ã–≤–∞–µ–º –ª—é–±—É—é –æ—Ç–∫—Ä—ã—Ç—É—é –º–æ–¥–∞–ª–∫—É
const openModalEl = document.querySelector('.bottom-sheet.open');
if (openModalEl) {
    closeModal(openModalEl.id);
}

// –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
if (["students", "schedule"].includes(pageId)) {
    createFloatingAddButton(pageId);
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
const newPage = document.getElementById(pageId);
if (newPage) {
    newPage.classList.add('active');
    this.currentPage = pageId;
    
    if (pageId !== "students") {
        document.getElementById("student-sidebar").classList.remove("open");
    } else {
        if (sidebarWasOpen) {
            document.getElementById("student-sidebar").classList.add("open");
        }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏
    document.querySelectorAll(`[data-page="${pageId}"]`).forEach(link => {
        link.classList.add('active');
    });
    
    // *** –í–°–¢–ê–í–¨–¢–ï –ó–î–ï–°–¨ –í–ê–® –§–†–ê–ì–ú–ï–ù–¢: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–æ –Ω–µ –¥–ª—è table –≤ schedule) ***
    const isTableActive = pageId === 'schedule' && document.querySelector('.schedule-tab[data-mode="table"].active');
    const savedScroll = localStorage.getItem(`scroll_${pageId}`) || 0;
    if (!isTableActive) { // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –¥–ª—è table
        window.scrollTo(0, savedScroll);
    }
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –≤–µ—Ä—Ö—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ > 0 –∏ –Ω–µ table)
    if (window.innerWidth < 768 && savedScroll === 0 && !isTableActive) {
        window.scrollTo(0, 0);
    }
    // *** –ö–û–ù–ï–¶ –í–ê–®–ï–ì–û –§–†–ê–ì–ú–ï–ù–¢–ê ***
}
// –î–æ–±–∞–≤–ª–µ–Ω–æ: –µ—Å–ª–∏ –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ schedule –∏ —Ç–∞–± "–¢–∞–±–ª–∏—Ü–∞" –∞–∫—Ç–∏–≤–µ–Ω, —Ä–µ–Ω–¥–µ—Ä–∏–º –Ω–µ–¥–µ–ª—é
if (pageId === "schedule" && document.querySelector('.schedule-tab[data-mode="table"].active')) {
    renderDropdown();
    renderWeek();
    goToday();  // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é
    setTimeout(() => {
        window.scrollTo(0, 0);  // –í—Å–µ–≥–¥–∞ —Å–∫—Ä–æ–ª–ª –∫ –≤–µ—Ä—Ö—É –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ table
    }, 100);
}

// –î–û–ë–ê–í–õ–ï–ù–û: –ê–≤—Ç–æ-—Å–∫—Ä–æ–ª–ª –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ schedule
if (pageId === 'schedule' && firstScheduleLoad) {
    setTimeout(() => {
        if (document.querySelector('.schedule-tab[data-mode="list"].active')) {
            scrollToToday();
        }
        firstScheduleLoad = false;
    }, 500);
}

// Dispatch —Å–æ–±—ã—Ç–∏—è –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞ (–µ—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å)
setTimeout(() => {
    const event = new CustomEvent('pageRendered', { detail: { page: pageId } });
    document.dispatchEvent(event);
    console.log(`–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${pageId} –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–∞, —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ`);
}, 100);
}
    
    handleResize() {
        console.log('–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω:', window.innerWidth);
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
const navigation = new Navigation();

// ===== –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö =====
let appData = {
    dashboard: null,
    students: [],
    schedule: []
};

// ===== –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö =====
async function loadData() {
// try {
//     const [studentsRes, lessonsRes] = await Promise.all([
//         apiClient( "/students/"),
//         apiClient( "/lessons/")
//     ]);
     try {
    const [studentsRes] = await Promise.all([
        apiClient( "/students/"),
        // apiClient( "/lessons/")
    ]);


    const students = await studentsRes.json();
    // const lessons = await lessonsRes.json();

    console.log("–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:", students);
    console.log("–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–Ω—è—Ç–∏–π:", lessons); // ‚Üê –î–û–õ–ñ–ù–û –ë–´–¢–¨ –í–ò–î–ù–û!

    appData.students = students;
    appData.schedule = lessons; // ‚Üê —Å—é–¥–∞ —Ç–æ—á–Ω–æ –ø–æ–ø–∞–¥–∞–µ—Ç

    renderStudents();
    renderScheduleList(); // ‚Üê —Ç–µ–ø–µ—Ä—å —Ç–æ—á–Ω–æ –≤—ã–∑–æ–≤–µ—Ç—Å—è
} catch (err) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", err);
}
}
// ===== –†–µ–Ω–¥–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ =====
async function loadDashboardData() {
try {
    //const response = await apiClient(  '/students/info');
//     if (response.status === 0||!response.ok ||response.status === 404 || !data || Object.keys(data).length === 0) {
//     response = await fetch(`${API}/students/info`);
// }
    const data = await response.json(); 

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    const stats = document.querySelectorAll('#dashboard .stat-card .stat-value');
    stats[0].textContent = data.studentsCount;
    stats[1].textContent = data.lessonsCount;
    stats[2].textContent = data.attendance + '%';
    stats[3].textContent = data.revenue + ' ‚ÇΩ';

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    const activityBlock = document.querySelector('#dashboard .section');
    activityBlock.innerHTML = `
        <h2 style="margin-bottom: 15px;">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
        ${data.activity.map(a => `<p>${a}</p>`).join('')}
    `;

} catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
}
}

async function loadSchedule() {
try {
    const res = await apiClient(  "/lessons/");
    const schedule = await res.json();

    appData.schedule = schedule;
    renderScheduleList();
} catch (e) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:", e);
}
}


// ===== –†–µ–Ω–¥–µ—Ä —É—á–µ–Ω–∏–∫–æ–≤ =====
// === –†–ï–ù–î–ï–† –°–ü–ò–°–ö–ê –£–ß–ï–ù–ò–ö–û–í (–ò–°–ü–†–ê–í–õ–ï–ù–û) ===
function renderStudents() {
const container = document.getElementById('students-list');
if (!appData.students || appData.students.length === 0) {
    container.innerHTML = "<p style='text-align:center; color:#8e8e93; padding:40px;'>–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</p>";
    return;
}

container.innerHTML = appData.students
    .sort((a, b) => a.name.localeCompare(b.name))
    .map((s, i) => `
        <div class="student-card" data-id="${s.id}">
            <div class="student-info">
                <div class="student-index">${i + 1}</div>
                <div class="student-name">${s.name}</div>
            </div>
            <div class="student-class">–ö–ª–∞—Å—Å ${s.grade || s.age || '?'}</div>
        </div>
    `)
    .join('');
}

function createFloatingAddButton(pageId) {
// –µ—Å–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
if (document.getElementById("floating-add-btn")) return;

const btn = document.createElement("button");
btn.id = "floating-add-btn";
btn.className = "floating-add-btn";
btn.textContent = "+";
btn.dataset.page = pageId;

// –≤–∞–∂–Ω–æ–µ: –ø–æ–≤–µ—Å–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä—è–º–æ –Ω–∞ –∫–Ω–æ–ø–∫—É (–Ω–µ —á–µ—Ä–µ–∑ –¥–µ–ª–µ–≥–∞—Ç)
// –∏—Å–ø–æ–ª—å–∑—É–µ–º pointerup ‚Äî –æ–Ω –Ω–∞–¥—ë–∂–Ω–µ–µ –ø—Ä–∏ —Ç–∞—á–∞—Ö/—Å–≤–∞–π–ø–∞—Ö
const openHandler = (ev) => {
    // –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –¥–∞–ª—å–Ω–µ–π—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ overlay –ª–æ–≤–∏—Ç)
    ev.stopPropagation();
    ev.preventDefault();

    if (btn.dataset.page === "students") {
        openModal('create-student-modal');
    } else if (btn.dataset.page === "schedule") {
        openModal('create-lesson-modal');
    }
};

btn.addEventListener('pointerup', openHandler);
// –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π ‚Äî —Ç–∞–∫–∂–µ —Å–ª—É—à–∞–µ–º click (fallback)
btn.addEventListener('click', openHandler);

// —á—Ç–æ–±—ã —ç–ª–µ–º–µ–Ω—Ç –±—ã–ª —Å—Ä–∞–∑—É –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º –∏ –Ω–µ "–∑–∞–ª–∏–ø–∞–ª"
btn.style.pointerEvents = "";

// —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ handler —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —É–±—Ä–∞—Ç—å –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
btn.__openHandler = openHandler;

document.body.appendChild(btn);
}

function removeFloatingAddButton() {
const btn = document.getElementById("floating-add-btn");
if (!btn) return;
// –µ—Å–ª–∏ –ø–æ–≤–µ—Å–∏–ª–∏ handler ‚Äî —É–¥–∞–ª—è–µ–º
if (btn.__openHandler) {
    btn.removeEventListener('pointerup', btn.__openHandler);
    btn.removeEventListener('click', btn.__openHandler);
    delete btn.__openHandler;
}
btn.remove();
}

function renderScheduleList() {
    const container = document.getElementById("lessons-container");
    const todayBtn = document.getElementById("today-btn");
    if (!container || !todayBtn) return;

    if (!appData.schedule) {
        container.innerHTML = `<p style="text-align:center;color:#8e8e93;padding:100px 20px;">–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π</p>`;
        todayBtn.className = "today-btn-compact no-lessons";
        todayBtn.textContent = "–°–µ–≥–æ–¥–Ω—è";
        return;
    }

    // –§–ò–ö–°: –ø–æ–ª—É—á–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD (–ª–æ–∫–∞–ª—å–Ω—É—é –¥–∞—Ç—É, –±–µ–∑ UTC)
    const today = new Date();
    const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

    const lessonsByDate = {};
    let hasToday = false;

    appData.schedule.forEach(lesson => {
        const dateKey = lesson.date; // —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "2025-12-07"
        if (!lessonsByDate[dateKey]) lessonsByDate[dateKey] = [];
        lessonsByDate[dateKey].push(lesson);

        // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –Ω–∞–ø—Ä—è–º—É—é ‚Äî 100% –Ω–∞–¥—ë–∂–Ω–æ
        if (dateKey === todayStr) {
            hasToday = true;
        }
    });

    // –î–û–ë–ê–í–õ–ï–ù–û: –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Å—Ç–æ–π
    if (!lessonsByDate[todayStr]) {
        lessonsByDate[todayStr] = [];
        hasToday = true;
    }

    const sortedDates = Object.keys(lessonsByDate).sort();

    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –∏ –±—É–¥—É—â–∏–µ –¥–∞—Ç—ã
    const futureDates = sortedDates.filter(date => date >= todayStr);

    const formatDateHeader = (dateStr) => {
        const isToday = dateStr === todayStr;
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowStr = `${tomorrow.getFullYear()}-${String(tomorrow.getMonth() + 1).padStart(2, '0')}-${String(tomorrow.getDate()).padStart(2, '0')}`;
        const isTomorrow = dateStr === tomorrowStr;
        const isPast = dateStr < todayStr;

        const date = new Date(dateStr + 'T12:00:00'); // –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—Ä–æ–±–ª–µ–º —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏
        const options = { weekday: 'long', day: 'numeric', month: 'long' };
        let header = date.toLocaleDateString('ru-RU', options);
        header = header.charAt(0).toUpperCase() + header.slice(1);

        if (isToday) return { text: "–°–µ–≥–æ–¥–Ω—è", isToday: true, isPast: false };
        if (isTomorrow) return { text: "–ó–∞–≤—Ç—Ä–∞", isToday: false, isPast: false };
        return { text: header, isToday: false, isPast };
    };

    let html = "";
    let todayFound = false;

    futureDates.forEach(date => {
        const { text, isToday, isPast } = formatDateHeader(date);
        const lessons = lessonsByDate[date].sort((a, b) => a.begin.localeCompare(b.begin));

        if (isToday) todayFound = true;

        html += `
            <div class="schedule-date-new ${isToday ? 'today' : ''} ${isPast ? 'past' : ''}" 
                 ${isToday ? 'id="today-section"' : ''}>
                ${text}
            </div>
        `;

        if (lessons.length === 0) {
            // –î–û–ë–ê–í–õ–ï–ù–û: –ü—É—Å—Ç–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –ø—É—Å—Ç–æ–≥–æ –¥–Ω—è (–≤–∫–ª—é—á–∞—è —Å–µ–≥–æ–¥–Ω—è)
            html += `
                <div class="lesson-card-new empty ${isPast ? 'past' : ''} ${isToday ? 'today' : ''}">
                    <div class="lesson-main">
                        <span class="lesson-name">–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π</span>
                    </div>
                </div>
            `;
        } else {
            lessons.forEach(l => {
                const extra = [];
                if (l.grade) extra.push(`${l.grade} –∫–ª–∞—Å—Å`);
                if (l.notes) extra.push(l.notes);
                const extraText = extra.length ? extra.join(" ‚Ä¢ ") : "";

                html += `
                    <div class="lesson-card-new ${isPast ? 'past' : ''} ${isToday ? 'today' : ''}" 
                         data-lesson-id="${l.id}">
                        <div class="lesson-main">
                            <span class="lesson-time">${l.begin} ‚Äì ${l.end}</span>
                            <span class="lesson-name">${l.name || "–£—á–µ–Ω–∏–∫"}</span>
                            ${extraText ? `<span class="lesson-grade">${extraText}</span>` : ""}
                        </div>

                        <div class="lesson-actions">
                            <button class="lesson-menu" onclick="toggleLessonMenu(event, ${l.id})">‚ãÆ</button>
                            <div class="lesson-dropdown" id="dropdown-${l.id}">
                                <div class="dropdown-item" onclick="editLesson(${l.id})">–ò–∑–º–µ–Ω–∏—Ç—å</div>
                                <div class="dropdown-item delete" onclick="deleteLesson(${l.id})">–£–¥–∞–ª–∏—Ç—å</div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
    });

    // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π, –ø–æ–∫–∞–∂–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (futureDates.length === 0) {
        html = `<p style="text-align:center;color:#8e8e93;padding:100px 20px;">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π</p>`;
        todayBtn.className = "today-btn-compact no-lessons";
        todayBtn.textContent = "–°–µ–≥–æ–¥–Ω—è";
    }

    container.innerHTML = html;

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
    todayBtn.className = "today-btn-compact";
    if (todayFound) {
        todayBtn.classList.add("has-lessons");
    } else {
        todayBtn.classList.add("no-lessons");
    }
    todayBtn.textContent = "–°–µ–≥–æ–¥–Ω—è";

    updateTodayButtonState();
}


async function loadStudentsData() {
try {
    const response = await apiClient('/students/stud');
  
    const students = await response.json();

    const container = document.getElementById('students-list');
    container.innerHTML = ""; // –æ—á–∏—â–∞–µ–º

    students.forEach(student => {
        const card = document.createElement('p');
        card.textContent = `${student.name} ‚Äî ${student.age} –ª–µ—Ç`;
        container.appendChild(card);
    });

} catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—á–µ–Ω–∏–∫–æ–≤:", error);
}
}

async function openStudentSidebar(id, updateOnly = false) {  // ‚Üê –î–û–ë–ê–í–ò–¢–¨: –ø–∞—Ä–∞–º–µ—Ç—Ä updateOnly
const sidebar = document.getElementById("student-sidebar");

if (selectingStudentForLesson) {
    const student = appData.students.find(s => s.id === parseInt(id));
    if (!student) return;

    document.getElementById('lesson-student-display').textContent = student.name;
    document.getElementById('lesson-student-id').value = student.id;

    selectingStudentForLesson = false;
    navigation.navigateTo('schedule');
    setTimeout(() => openModal('create-lesson-modal'), 200);
    return;
}

if (!updateOnly) {  // ‚Üê –î–û–ë–ê–í–ò–¢–¨: –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–µ –≤ if
    sidebar.classList.add("open");
}
sidebar.dataset.studentId = id;

const student = appData.students.find(s => s.id === parseInt(id));
if (!student) return;

document.getElementById("sidebar-name").textContent = student.name || "–ë–µ–∑ –∏–º–µ–Ω–∏";
document.getElementById("sidebar-age").textContent = student.grade ? `${student.grade} –∫–ª–∞—Å—Å` : "‚Äî";
document.getElementById("sidebar-info").textContent = student.descriptions || "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
document.getElementById("sidebar-phone").textContent = student.contacts || "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
}
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadDashboardData();
    // loadStudentsData();
    // loadSchedule()
    loadData();
     
    
document.querySelector(".close-sidebar").addEventListener("click", () => {
const sidebar = document.getElementById("student-sidebar");
sidebar.classList.remove("open");
sidebarWasOpen = false;

// —Å–±—Ä–æ—Å —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
document.getElementById("edit-buttons").style.display = "none";
const currentId = sidebar.dataset.studentId;
if (currentId) {
    openStudentSidebar(currentId, true);  // ‚Üê –ó–ê–ú–ï–ù–ò–¢–¨: –¥–æ–±–∞–≤—å true –¥–ª—è updateOnly
}
document.getElementById("sidebar-edit-btn").style.display = "block";
});
    
// ===== –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ —Å–≤–∞–π–ø–æ–º –≤–ø—Ä–∞–≤–æ =====
let startX = 0;

const sidebar = document.getElementById("student-sidebar");

sidebar.addEventListener("touchstart", (e) => {
startX = e.touches[0].clientX;
});

sidebar.addEventListener("touchmove", (e) => {
const deltaX = e.touches[0].clientX - startX;

// –ï—Å–ª–∏ —Ç—è–Ω–µ–º –≤–ø—Ä–∞–≤–æ ‚Äî —Å–º–µ—â–∞–µ–º –ø–∞–Ω–µ–ª—å
if (deltaX > 0) {
    sidebar.style.transform = `translateX(${deltaX}px)`;
}
});

sidebar.addEventListener("touchend", (e) => {
const deltaX = e.changedTouches[0].clientX - startX;

// –ï—Å–ª–∏ —Å–º–∞—Ö–Ω—É–ª–∏ –≤–ø—Ä–∞–≤–æ –±–æ–ª—å—à–µ —á–µ–º –Ω–∞ 80px ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ–º
if (deltaX > 80) {
    sidebar.classList.remove("open");
    
    // —Å–±—Ä–æ—Å —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    document.getElementById("edit-buttons").style.display = "none";
    const currentId = sidebar.dataset.studentId;
    if (currentId) {
        openStudentSidebar(currentId, true);  // ‚Üê –ó–ê–ú–ï–ù–ò–¢–¨: –¥–æ–±–∞–≤—å true –¥–ª—è updateOnly
    }
    document.getElementById("sidebar-edit-btn").style.display = "block";
}

// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –º–µ—Å—Ç–æ
sidebar.style.transform = "";
});

loadSchedule() 
loadSchedule().then(() => {
updateTodayButtonState();  // –ù–∞—á–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
});// –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
// --------------------------------------
document.querySelectorAll('.schedule-tab').forEach(tab => {
tab.addEventListener('click', () => {
    const mode = tab.dataset.mode;

    // *** –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–æ–ª–ª –ø–µ—Ä–µ–¥ —Å–º–µ–Ω–æ–π —Ç–∞–±–∞ (–¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–æ–≤) ***
    localStorage.setItem('scroll_schedule', window.scrollY);

    document.querySelectorAll('.schedule-tab')
        .forEach(t => t.classList.remove('active'));

    tab.classList.add('active');

    document.querySelectorAll('.schedule-view')
        .forEach(v => v.classList.remove('active'));

    document.getElementById(`schedule-${mode}-view`).classList.add('active');
    
    // *** –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–ª—è table ‚Äî –≤—Å–µ–≥–¥–∞ —Å–∫—Ä–æ–ª–ª –∫ top, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π ***
    if (mode === 'table') {
        renderDropdown();
        renderWeek();
        goToday();  // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        setTimeout(() => {
            window.scrollTo(0, 0);  // –í—Å–µ–≥–¥–∞ –∫ –≤–µ—Ä—Ö—É
        }, 100);  // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞
    }

    // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∞–±–æ–≤ ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª
    setTimeout(() => {
        updateTodayButtonState();
        if (tab.dataset.mode === 'list' && !document.getElementById("today-section")) {
            renderScheduleList();
        }
        if (mode !== 'table') {  // –¢–æ–ª—å–∫–æ –Ω–µ –¥–ª—è table
            const savedScroll = localStorage.getItem('scroll_schedule') || 0;
            window.scrollTo(0, savedScroll);
        }
    }, 100);
});
});

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ —á–µ—Ä–µ–∑ –ø–ª–∞–≤–∞—é—â—É—é –∫–Ω–æ–ø–∫—É
document.body.addEventListener("click", (e) => {
const btn = e.target.closest("#floating-add-btn");
if (!btn) return;

if (btn.dataset.page === "students") {
    openModal('create-student-modal');
}
});

// ------ –ó–ê–ú–ï–ù–ò–¢–¨ –°–¢–ê–†–´–ï –§–£–ù–ö–¶–ò–ò/–û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ù–ê –≠–¢–û: ------
// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–µ–≥–æ–¥–Ω—è" ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö views
// –û–±–Ω–æ–≤–ª—è–µ–º handleTodayButton() ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é smooth-—Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è list
function handleTodayButton() {
const activeView = document.querySelector('.schedule-view.active');
if (!activeView) return;

const mode = activeView.id.replace('schedule-', '').replace('-view', '');

switch (mode) {
    case 'list':
        scrollToToday();  // –¢–µ–ø–µ—Ä—å smooth!
        break;
    case 'table':
        goToday();  // –í–∞—à –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ‚Äî —Ä–µ–Ω–¥–µ—Ä –Ω–µ–¥–µ–ª–∏ (—É–∂–µ smooth)
        break;
    case 'calendar':
        showToast('–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–º—É –¥–Ω—é –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
        break;
    default:
        console.warn('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º:', mode);
}
}
// –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –æ–¥–∏–Ω —Ä–∞–∑
const overlay = document.getElementById("overlay");

// –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ –ø–æ ID
function openModal(modalId) {
const modalEl = document.getElementById(modalId);
if (!modalEl) return;
if (document.querySelector('.bottom-sheet.open')) return; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–∞–ª–æ–∫

modalEl.classList.add("open");
overlay.classList.add("show");
document.body.style.overflow = "hidden";

// –°–∫—Ä—ã—Ç—å –ø–ª–∞–≤–∞—é—â—É—é –∫–Ω–æ–ø–∫—É
removeFloatingAddButton();

// –°–±—Ä–æ—Å transform
modalEl.style.transform = "translateY(0)";

// –î–ª—è –º–æ–¥–∞–ª–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è: –∑–∞–ø–æ–ª–Ω—è–µ–º select —É—á–µ–Ω–∏–∫–∞–º–∏ (–î–û–†–ê–ë–û–¢–ö–ê)

}

// –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ –ø–æ ID
function closeModal(modalId) {
const modalEl = document.getElementById(modalId);
if (!modalEl) return;
modalEl.classList.remove("open");
overlay.classList.remove("show");
overlay.style.pointerEvents = 'none'; // –°—Ä–∞–∑—É –æ—Ç–∫–ª—é—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –Ω–∞ –æ–≤–µ—Ä–ª–µ–µ
document.body.style.overflow = ""; // –°–±—Ä–æ—Å overflow —Å—Ä–∞–∑—É
modalEl.style.transform = "";

// –°–±—Ä–æ—Å –¥–ª—è edit-modal (–¥–∞—Ç–∞, –≤—Ä–µ–º—è, –∑–∞–º–µ—Ç–∫–∏ ‚Äî —É—á–µ–Ω–∏–∫ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º)
if (modalId === 'edit-lesson-modal') {
    document.getElementById('edit-lesson-date').value = '';
    document.getElementById('edit-lesson-start-picker').textContent = '12:00';
    document.getElementById('edit-lesson-start-input').value = '12:00';
    document.getElementById('edit-lesson-end-picker').textContent = '13:00';
    document.getElementById('edit-lesson-end-input').value = '13:00';
    document.getElementById('edit-lesson-notes').value = '';
    document.getElementById('edit-lesson-recurring').checked = false;
    delete document.getElementById('edit-lesson-modal').dataset.lessonId;
}

// resetAllModals();  // –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –æ—Å—Ç–∞–≤—å, –∏–Ω–∞—á–µ —É–¥–∞–ª–∏
// –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –æ–±—Ä–∞—Ç–Ω–æ (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏)
setTimeout(() => {
    if (["students", "schedule"].includes(navigation.currentPage)) {
        createFloatingAddButton(navigation.currentPage);
    }
    overlay.style.pointerEvents = ''; // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
}, 250); // 250ms –¥–ª—è opacity transition
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è swipe/drag handlers –∫ –ª—é–±–æ–π –º–æ–¥–∞–ª–∫–µ
function attachSwipeHandlers(modalEl) {
if (!modalEl) return;

let startY = 0;
let currentY = 0;
let isDragging = false;

const SWIPE_CLOSE = 120;

// Touch start
modalEl.addEventListener("touchstart", (e) => {
    isDragging = true;
    startY = e.touches[0].clientY;
    currentY = 0;
    modalEl.style.transition = "none";
}, { passive: true });

// Touch move ‚Äî –ö–†–ò–¢–ò–ß–ù–û –î–õ–Ø SAFARI
modalEl.addEventListener("touchmove", (e) => {
    if (!isDragging) return;

    currentY = e.touches[0].clientY - startY;

    // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç—è–Ω—É—Ç—å –≤–Ω–∏–∑ (currentY > 0)
    if (currentY > 0) {
        e.preventDefault(); // ‚Üê –ò–º–µ–Ω–Ω–æ —ç—Ç–æ —É–±–∏–≤–∞–µ—Ç –±–∞–≥ —Å –¥–≤–æ–π–Ω—ã–º —Ç–∞–ø–æ–º –≤ Safari
        modalEl.style.transform = `translateY(${currentY}px)`;
    }
}, { passive: false }); // ‚Üê –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ false!

// Touch end
modalEl.addEventListener("touchend", () => {
    if (!isDragging) return;
    isDragging = false;

    modalEl.style.transition = "transform 0.25s ease-in-out";

    if (currentY > SWIPE_CLOSE) {
        closeModal(modalEl.id);
    } else {
        modalEl.style.transform = "translateY(0)";
    }
}, { passive: true });

// Mouse drag (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞) ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
let mouseDragging = false;
modalEl.addEventListener("mousedown", (e) => {
    if (!modalEl.classList.contains("open")) return;
    mouseDragging = true;
    startY = e.clientY;
    modalEl.style.transition = "none";
});

window.addEventListener("mousemove", (e) => {
    if (!mouseDragging) return;
    currentY = e.clientY - startY;
    if (currentY > 0) {
        modalEl.style.transform = `translateY(${currentY}px)`;
    }
});

window.addEventListener("mouseup", () => {
    if (!mouseDragging) return;
    mouseDragging = false;
    modalEl.style.transition = "transform 0.25s ease-in-out";

    if (currentY > SWIPE_CLOSE) {
        closeModal(modalEl.id);
    } else {
        modalEl.style.transform = "translateY(0)";
    }
});
}
attachSwipeHandlers(document.getElementById("create-student-modal"));
attachSwipeHandlers(document.getElementById("create-lesson-modal"));
attachSwipeHandlers(document.getElementById("edit-lesson-modal"));

// –ö—Ä–µ—Å—Ç–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è –æ–±–µ–∏—Ö –º–æ–¥–∞–ª–æ–∫
document.querySelectorAll('.sheet-close').forEach(closeBtn => {
closeBtn.addEventListener('click', (e) => {
    const modalEl = e.target.closest('.bottom-sheet');
    if (modalEl) closeModal(modalEl.id);
});
});

// Overlay: –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –º–æ–¥–∞–ª–∫—É
overlay.addEventListener("click", () => {
const openModalEl = document.querySelector('.bottom-sheet.open');
if (openModalEl) closeModal(openModalEl.id);
});

// ----- –ö–ù–û–ü–ö–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è) -----
// –ü–æ–∫–∞ —ç—Ç–æ –∑–∞–≥–ª—É—à–∫–∏. –î–æ–±–∞–≤—å—Ç–µ fetch –≤ API –∑–¥–µ—Å—å.
// ===== –°–û–ó–î–ê–ù–ò–ï –ù–û–í–û–ì–û –£–ß–ï–ù–ò–ö–ê =====
document.getElementById('create-student-btn').addEventListener('click', async () => {
// –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
const name = document.getElementById('student-name-input').value.trim();
const grade = document.getElementById('student-age-input').value.trim(); // —É —Ç–µ–±—è —Å–µ–π—á–∞—Å "–ö–ª–∞—Å—Å"
const contact = document.getElementById('student-phone-input').value.trim();
const info = document.getElementById('student-info-input').value.trim();

// –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
if (!name) {
    alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞');
    return;
}
if (!grade || isNaN(grade) || grade < 1 || grade > 11) {
    alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å (1‚Äì11)');
    return;
}

const newStudent = {
    name: name,
    grade: parseInt(grade),
    contacts: contact || null,
    descriptions: info || null
};

try {
    const response = await apiClient( '/students/create', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(newStudent)
    });

    if (response.ok) {
        const created = await response.json();
        console.log('–£—á–µ–Ω–∏–∫ —Å–æ–∑–¥–∞–Ω:', created);

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
        closeModal('create-student-modal');

        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
        document.getElementById('student-name-input').value = '';
        document.getElementById('student-age-input').value = '';
        document.getElementById('student-phone-input').value = '';
        document.getElementById('student-info-input').value = '';

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤
        await loadData();

        // –ö—Ä–∞—Å–∏–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        showToast('–£—á–µ–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');

    } else {
        const error = await response.text();
        alert('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + error);
    }
} catch (err) {
    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', err);
    alert('–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.');
}
});

document.getElementById('create-lesson-btn').addEventListener('click', async () => {
const studentId = document.getElementById('lesson-student-id').value;
const date = document.getElementById('lesson-date').value;           // ‚Üê –ù–û–í–ê–Ø –°–¢–†–û–ö–ê
const begin = document.getElementById('lesson-start-input').value;
const end = document.getElementById('lesson-end-input').value;
const notes = document.getElementById('lesson-notes')?.value.trim() || null;
const recurring = document.getElementById('lesson-recurring').checked;
let weeks = 1; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1, –µ—Å–ª–∏ –Ω–µ recurring
if (recurring) {
    weeks = parseInt(document.getElementById('lesson-recurring-weeks').value) || 1;
    if (weeks < 1 || weeks > 52) {
        alert('–£–∫–∞–∂–∏—Ç–µ –Ω–µ–¥–µ–ª–∏ –æ—Ç 1 –¥–æ 52');
        return;
    }
}

if (!studentId || !date || !begin || !end) {
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è: —É—á–µ–Ω–∏–∫, –¥–∞—Ç–∞, –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞");
    return;
}

const payload = {
    student_id: parseInt(studentId),
    date: date,           // ‚Üê —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–∞—Ç–∞
    begin: begin,         // "14:30"
    end: end,             // "15:30"
    notes: notes,
    recurring: false,
    weeks : weeks
};

console.log("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä:", payload);

try {
    const res = await apiClient( "/lessons/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    if (res.ok) {
        closeModal('create-lesson-modal');
        document.getElementById('lesson-student-display').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞';
document.getElementById('lesson-student-id').value = '';
document.getElementById('lesson-student-name').value = '';

document.getElementById('lesson-date').value = '';

// –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
document.getElementById('lesson-start-picker').textContent = '12:00';
document.getElementById('lesson-start-input').value = '12:00';
document.getElementById('lesson-end-picker').textContent = '13:00';
document.getElementById('lesson-end-input').value = '13:00';

document.getElementById('lesson-notes').value = '';
document.getElementById('lesson-recurring').checked = false;
document.getElementById('lesson-recurring-weeks').value = '4'; // –°–±—Ä–æ—Å –Ω–∞ –¥–µ—Ñ–æ–ª—Ç
document.getElementById('recurring-weeks-field').style.display = 'none';
// –°–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤
selectingStudentForLesson = false;
        showToast("–ó–∞–Ω—è—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!");
        loadData();   
        loadSchedule();                  // ‚Üê –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
    } else {
        const err = await res.text();
        alert("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: " + err);
    }
} catch (e) {
    console.error(e);
    alert("–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
}
});

document.getElementById('edit-lesson-btn').addEventListener('click', async () => {
const lessonId = document.getElementById('edit-lesson-modal').dataset.lessonId;
const studentId = document.getElementById('edit-lesson-student-id').value;
const date = document.getElementById('edit-lesson-date').value;
const begin = document.getElementById('edit-lesson-start-input').value;
const end = document.getElementById('edit-lesson-end-input').value;
const notes = document.getElementById('edit-lesson-notes')?.value.trim() || null;
const recurring = document.getElementById('edit-lesson-recurring').checked;

if (!studentId || !date || !begin || !end) {
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è");
    return;
}

const payload = {
    student_id: parseInt(studentId),
    date: date,
    begin: begin,
    end: end,
    notes: notes,
    recurring: recurring
};

try {
    const res = await apiClient( `/lesson/${lessonsId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload)
    });

    if (res.ok) {
        closeModal('edit-lesson-modal');
        showToast("–ó–∞–Ω—è—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!");
        loadData();  // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        loadSchedule();  // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
    } else {
        const err = await res.text();
        alert("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: " + err);
    }
} catch (e) {
    console.error(e);
    alert("–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
}
});

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è —Ä–µ–∂–∏–º–∞ –≤—ã–±–æ—Ä–∞ —É—á–µ–Ω–∏–∫–∞
let selectingStudentForLesson = false;
let previousPage = null; // –î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –ø–æ–ª–µ "–£—á–µ–Ω–∏–∫" ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å—Ç—É–¥–µ–Ω—Ç–∞–º
document.getElementById('lesson-student-picker').addEventListener('click', () => {
selectingStudentForLesson = true;
previousPage = navigation.currentPage; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (schedule)
closeModal('create-lesson-modal'); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –≤—Ä–µ–º–µ–Ω–Ω–æ
navigation.navigateTo('students'); // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —É—á–µ–Ω–∏–∫–∞–º
});
document.getElementById('lesson-recurring').addEventListener('change', (e) => {
    document.getElementById('recurring-weeks-field').style.display = e.target.checked ? 'block' : 'none';
});
// –û–¢–ü–†–ê–í–ö–ê –ù–û–í–û–ì–û –ó–ê–ù–Ø–¢–ò–Ø (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∏–ª–∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ)
document.getElementById('create-lesson-btn').addEventListener('click', async () => {
const student_id = document.getElementById('lesson-student-id').value;
// const studentName = document.getElementById('lesson-student-name').value;
const date = document.getElementById('lesson-weekday').value;
const begin = document.getElementById('lesson-start-input').value;
const end = document.getElementById('lesson-end-input').value;
const recurring = document.getElementById('lesson-recurring').checked;

if (!studentId || !start || !end) {
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
    return;
}

const lessonData = {
    student_id: parseInt(student_id),
    // student_name: studentName,
    date: parseInt(date),
    begin: begin,
    end: end,
    recurring: recurring
};

try {
    const response = await apiClient( '/lessons/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(lessonData)
    });

    if (response.ok) {
        closeModal('create-lesson-modal');
        document.getElementById('lesson-student-display').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞';
        document.getElementById('lesson-student-id').value = '';
        document.getElementById('lesson-student-name').value = '';
        
        document.getElementById('lesson-date').value = '';
        
        // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
        document.getElementById('lesson-start-picker').textContent = '12:00';
        document.getElementById('lesson-start-input').value = '12:00';
        document.getElementById('lesson-end-picker').textContent = '13:00';
        document.getElementById('lesson-end-input').value = '13:00';
        
        document.getElementById('lesson-notes').value = '';
        document.getElementById('lesson-recurring').checked = false;

// –°–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤
        selectingStudentForLesson = false;
        loadData(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –¥–∞—à–±–æ—Ä–¥
        alert("–ó–∞–Ω—è—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ!");
    } else {
        alert("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–Ω—è—Ç–∏—è");
    }
} catch (err) {
    console.error(err);
    alert("–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
}
});
// –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ö–õ–ò–ö –ü–û –õ–Æ–ë–û–ô –ö–ê–†–¢–û–ß–ö–ï –£–ß–ï–ù–ò–ö–ê ‚Äî –†–ê–ë–û–¢–ê–ï–¢ –í–°–ï–ì–î–ê
document.addEventListener('click', (e) => {
const card = e.target.closest('.student-card');
if (!card) return;

const id = card.dataset.id;

if (selectingStudentForLesson) {
    e.preventDefault();
    e.stopPropagation();        document.getElementById('lesson-student-id').value = '';
        document.getElementById('lesson-student-name').value = '';
        
        document.getElementById('lesson-date').value = '';
        
        // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
        document.getElementById('lesson-start-picker').textContent = '12:00';
        document.getElementById('lesson-start-input').value = '12:00';
        document.getElementById('lesson-end-picker').textContent = '13:00';
        document.getElementById('lesson-end-input').value = '13:00';
        
        document.getElementById('lesson-notes').value = '';
        document.getElementById('lesson-recurring').checked = false;


    const name = card.querySelector('.student-name').textContent;

    document.getElementById('lesson-student-display').textContent = name;
    document.getElementById('lesson-student-id').value = id;
    document.getElementById('lesson-student-name').value = name;

    selectingStudentForLesson = false;
    navigation.navigateTo('schedule');
    setTimeout(() => openModal('create-lesson-modal'), 150);
} else {
    openStudentSidebar(id);
}
});

// –ö—Ä–∞—Å–∏–≤–æ–µ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —Å—Ç–∏–ª–µ iOS
function showToast(message) {
const oldToast = document.getElementById('toast');
if (oldToast) oldToast.remove();

const toast = document.createElement('div');
toast.id = 'toast';
toast.textContent = message;
toast.style.cssText = `
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 14px 24px;
    border-radius: 12px;
    font-size: 15px;
    z-index: 10000;
    animation: toastFade 3s forwards;
    pointer-events: none;
`;

document.body.appendChild(toast);

const style = document.createElement('style');
style.textContent = `
    @keyframes toastFade {
        0%, 100% { opacity: 0; transform: translateX(-50%) translateY(20px); }
        15%, 85% { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
`;
document.head.appendChild(style);

setTimeout(() => {
    if (toast && toast.parentNode) {
        toast.remove();
        style.remove();
    }
}, 3000);
}

// –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –º–µ–Ω—é
function toggleLessonMenu(e, lessonId) {
    e.stopPropagation();
    e.preventDefault(); // –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
    document.querySelectorAll('.lesson-dropdown.show').forEach(menu => {
        if (menu.id !== `dropdown-${lessonId}`) menu.classList.remove('show');
    });
    const menu = document.getElementById(`dropdown-${lessonId}`);
    menu.classList.toggle('show');
}

// –ó–∞–∫—Ä—ã–≤–∞—Ç—å –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
document.addEventListener('click', (e) => {
    if (!e.target.closest('.lesson-actions')) {
        document.querySelectorAll('.lesson-dropdown.show').forEach(menu => {
            menu.classList.remove('show');
        });
    }
});

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω—è—Ç–∏–µ
function editLesson(id) {
const lesson = appData.schedule.find(l => l.id === id);
if (!lesson) {
    alert('–ó–∞–Ω—è—Ç–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
    return;
}

// –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è (—É—á–µ–Ω–∏–∫ ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –±–µ–∑ —Å–º–µ–Ω—ã)
document.getElementById('edit-lesson-student-id').value = lesson.student_id;  // –î–ª—è PUT
document.getElementById('edit-lesson-student-display').textContent = lesson.student_name || lesson.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—á–µ–Ω–∏–∫';

document.getElementById('edit-lesson-date').value = lesson.date;
document.getElementById('edit-lesson-start-picker').textContent = lesson.begin;
document.getElementById('edit-lesson-start-input').value = lesson.begin;
document.getElementById('edit-lesson-end-picker').textContent = lesson.end;
document.getElementById('edit-lesson-end-input').value = lesson.end;
document.getElementById('edit-lesson-notes').value = lesson.notes || '';
document.getElementById('edit-lesson-recurring').checked = lesson.recurring || false;

// –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –∑–∞–Ω—è—Ç–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
document.getElementById('edit-lesson-modal').dataset.lessonId = id;

// –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
document.querySelectorAll('.lesson-dropdown.show').forEach(menu => menu.classList.remove('show'));

openModal('edit-lesson-modal');
}

// –£–¥–∞–ª–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ
async function deleteLesson(id) {
if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–Ω—è—Ç–∏–µ?")) return;

try {
    const res = await apiClient(`/lessons/${id}/`, { method: 'DELETE' });
    if (res.ok) {
        loadData();  // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        loadSchedule();  // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        showToast("–ó–∞–Ω—è—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ");
    } else {
        alert("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è");
    }
} catch (e) {
    alert("–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
}
}
// ===== –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–ö–ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –£–ß–ï–ù–ò–ö–ê (‚úé) =====

// –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
document.getElementById("sidebar-edit-btn").addEventListener("click", () => {
document.getElementById("edit-buttons").style.display = "flex";

// –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ input'—ã —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ —Å—Ç–∏–ª—è–º–∏
const name = document.getElementById("sidebar-name").textContent;
const grade = document.getElementById("sidebar-age").textContent.replace(/\D/g, "");
const info = document.getElementById("sidebar-info").textContent;
const phone = document.getElementById("sidebar-phone").textContent;

document.getElementById("sidebar-name").innerHTML =
    `<input id="edit-name" class="custom-input" value="${name}" style="width:100%;">`;

document.getElementById("sidebar-age").innerHTML =
    `<input id="edit-grade" type="number" class="custom-input" value="${grade || ''}" min="1" max="11" style="width:100%;">`;

document.getElementById("sidebar-info").innerHTML =
    `<textarea id="edit-info" class="custom-textarea" style="width:100%; min-height:80px;">${info}</textarea>`;

document.getElementById("sidebar-phone").innerHTML =
    `<input id="edit-phone" class="custom-input" value="${phone}" style="width:100%;">`;

// ‚Üê –î–û–ë–ê–í–ò–¢–¨: —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
document.getElementById("sidebar-edit-btn").style.display = "none";
}); 

// ===== –ö–ù–û–ü–ö–ê –û–¢–ú–ï–ù–ê =====
document.getElementById("edit-cancel-btn").addEventListener("click", () => {
document.getElementById("edit-buttons").style.display = "none";
const openId = document.getElementById("student-sidebar").dataset.studentId;  // ‚Üê –ó–ê–ú–ï–ù–ò–¢–¨: –∏—Å–ø–æ–ª—å–∑—É–µ–º dataset
document.getElementById("sidebar-edit-btn").style.display = "block";
if (openId) openStudentSidebar(openId);  // –ø—Ä–æ—Å—Ç–æ –∑–∞–Ω–æ–≤–æ –æ—Ç–∫—Ä—ã–≤–∞–µ–º, –ø–æ–ª—è –≤–µ—Ä–Ω—É—Ç—Å—è –∫ —Ç–µ–∫—Å—Ç—É
});


// ===== –ö–ù–û–ü–ö–ê –°–û–•–†–ê–ù–ò–¢–¨ =====
document.getElementById("edit-save-btn").addEventListener("click", async () => {
const id = document.getElementById("student-sidebar").dataset.studentId;  // ‚Üê –ó–ê–ú–ï–ù–ò–¢–¨: –∏—Å–ø–æ–ª—å–∑—É–µ–º dataset
if (!id) {
    alert("–û—à–∏–±–∫–∞: ID —É—á–µ–Ω–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω");
    return;
}

const name = document.getElementById("edit-name").value.trim();
const grade = parseInt(document.getElementById("edit-grade").value);
const descriptions = document.getElementById("edit-info").value.trim();
const contacts = document.getElementById("edit-phone").value.trim();

// –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
if (!name) {
    alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è");
    return;
}
if (isNaN(grade) || grade < 1 || grade > 11) {
    alert("–ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 11");
    return;
}

const payload = {
    name: name,
    grade: grade,
    descriptions: descriptions || null,
    contacts: contacts || null
};

try {
    
    const response = await apiClient( `/students/update/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload)
    });

    if (!response.ok) {
        throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
    }

    showToast("–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã");
    document.getElementById("sidebar-edit-btn").style.display = "block";
    document.getElementById("edit-buttons").style.display = "none";
    await loadData();  // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤
    openStudentSidebar(id);  // –æ–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å (–ø–æ–ª—è –≤–µ—Ä–Ω—É—Ç—Å—è –∫ —Ç–µ–∫—Å—Ç—É)
} catch (err) {
    alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: " + err.message);
}
});
// ===== –ö–ù–û–ü–ö–ê –£–î–ê–õ–ï–ù–ò–Ø –£–ß–ï–ù–ò–ö–ê =====
document.getElementById("delete-student-btn").addEventListener("click", async () => {
const sidebar = document.getElementById("student-sidebar");
const id = sidebar.dataset.studentId;
if (!id) {
    alert("–û—à–∏–±–∫–∞: ID —É—á–µ–Ω–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω");
    return;
}

if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")) {
    return;
}

try {
    const response = await apiClient(`/students/${id}`, {  // ‚Üê –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è DELETE ‚Äî /students/{id}/ (–∫–∞–∫ –≤ deleteLesson)
        method: "DELETE"
    });

    if (!response.ok) {
        throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
    }

    showToast("–£—á–µ–Ω–∏–∫ —É–¥–∞–ª—ë–Ω");
    sidebar.classList.remove("open");  // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
    loadData();  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤ –∏ –¥–∞—à–±–æ—Ä–¥
    loadSchedule();
} catch (err) {
    alert("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: " + err.message);
}
});

// –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –Ω–µ–¥–µ–ª—å–Ω–æ–π —Å–µ—Ç–∫–∏ (–º–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –Ω–µ–¥–µ–ª–∏ –∏–∑ appData.schedule, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –º–∏–Ω–∏–º—É–º DOM-–æ–ø–µ—Ä–∞—Ü–∏–π)
let currentWeekStart = new Date();
currentWeekStart.setDate(currentWeekStart.getDate() - ((currentWeekStart.getDay() + 6) % 7));
const months = ['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];

function wKey(d) { return d.toISOString().split('T')[0]; } // –ö–ª—é—á –¥–∞—Ç—ã

// –ö—ç—à–∏—Ä—É–µ–º —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏ –ø–æ –¥–∞—Ç–∞–º (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑)
let cachedLessonsByDate = null;

function getLessonsByDate() {
if (cachedLessonsByDate) return cachedLessonsByDate; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à

cachedLessonsByDate = {};
appData.schedule.forEach(lesson => {
    const date = lesson.date;
    if (!cachedLessonsByDate[date]) {
        cachedLessonsByDate[date] = [];
    }
    cachedLessonsByDate[date].push(lesson);
});
return cachedLessonsByDate;
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–µ–¥–µ–ª—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞—Ç –≤ schedule
function getAvailableWeeks() {
const dates = Object.keys(getLessonsByDate()).sort();
if (dates.length === 0) return []; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö

const weeks = new Set();
dates.forEach(dateStr => {
    const d = new Date(dateStr);
    d.setDate(d.getDate() - ((d.getDay() + 6) % 7)); // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫—É –Ω–µ–¥–µ–ª–∏
    weeks.add(wKey(d));
});

return Array.from(weeks).sort();
}

function renderDropdown() {
const menu = document.getElementById("dropdown-menu");
menu.innerHTML = "";

const availableWeeks = getAvailableWeeks();
if (availableWeeks.length === 0) {
    menu.innerHTML = '<div class="dropdown-item" style="text-align:center; color:#888;">–ù–µ—Ç –Ω–µ–¥–µ–ª—å —Å –∑–∞–Ω—è—Ç–∏—è–º–∏</div>';
    return;
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å—Ä–∞–∑—É (–º–∏–Ω–∏–º—É–º DOM-–æ–ø–µ—Ä–∞—Ü–∏–π)
let html = '';
availableWeeks.forEach(key => {
    const d = new Date(key);
    const end = new Date(d);
    end.setDate(end.getDate() + 6);
    const label = `${d.getDate()}‚Äì${end.getDate()} ${months[end.getMonth()]}`;
    html += `<div class="dropdown-item" data-key="${key}">${label}</div>`;
});
menu.innerHTML = html;

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ (–¥–µ–ª–µ–≥–∏—Ä—É–µ–º –Ω–∞ –º–µ–Ω—é)
menu.addEventListener('click', (e) => {
    const item = e.target.closest('.dropdown-item');
    if (!item) return;
    
    currentWeekStart = new Date(item.dataset.key);
    renderWeek();
    document.getElementById("dropdown-label").textContent = item.textContent;
    toggleDropdown(true);
}); // –£–±—Ä–∞–ª–∏ {once: true}
}

function toggleDropdown(forceClose = false) {
const menu = document.getElementById("dropdown-menu");

if (forceClose) {
    menu.style.display = "none";
    return;
}

menu.style.display = menu.style.display === "block" ? "none" : "block";
}

document.addEventListener("click", (e) => {
const dd = document.querySelector(".dropdown");
if (!dd.contains(e.target)) {
    toggleDropdown(true);
}
});

function renderWeek() {
const grid = document.getElementById("week-grid");
grid.innerHTML = ""; // –û—á–∏—â–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑

const lessonsByDate = getLessonsByDate();
let d = new Date(currentWeekStart);
let html = ''; // –°–æ–±–∏—Ä–∞–µ–º –≤–µ—Å—å HTML –∑–∞—Ä–∞–Ω–µ–µ

for (let i = 0; i < 7; i++) {
    const dateKey = wKey(d);
    const dayLessons = (lessonsByDate[dateKey] || []).sort((a, b) => a.begin.localeCompare(b.begin));
    
    const label = `${['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'][d.getDay()==0?6:d.getDay()-1]}, ${d.getDate()} ${months[d.getMonth()]}`;
    
    let lessonsHtml = dayLessons.length > 0 
        ? dayLessons.map(l => `
            <div class="week-lesson-card">
                <div class="week-lesson-time">${l.begin} ‚Äì ${l.end}</div>
                <div class="week-lesson-student">${l.name || "–£—á–µ–Ω–∏–∫"} ${l.grade > 0 ? `(${l.grade} –∫–ª–∞—Å—Å)` : ""} ${l.notes ? `(${l.notes})` : ''}</div>
            </div>
        `).join('')
        : '<div class="empty-day">–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π</div>';
    
    html += `
        <div class="day-col">
            <div class="day-header">${label}</div>
            ${lessonsHtml}
        </div>
    `;
    
    d.setDate(d.getDate() + 1);
}

grid.innerHTML = html;
updateTodayButtonState();
 // –í—Å—Ç–∞–≤–ª—è–µ–º –≤–µ—Å—å HTML –æ–¥–Ω–∏–º –≤—ã–∑–æ–≤–æ–º (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DOM)
}

function prevWeek() {
const availableWeeks = getAvailableWeeks();
const currentIndex = availableWeeks.indexOf(wKey(currentWeekStart));
if (currentIndex > 0) {
    currentWeekStart = new Date(availableWeeks[currentIndex - 1]);
    renderWeek();
} else {
    showToast("–ù–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ —Å –∑–∞–Ω—è—Ç–∏—è–º–∏");
}
}

function nextWeek() {
const availableWeeks = getAvailableWeeks();
const currentIndex = availableWeeks.indexOf(wKey(currentWeekStart));
if (currentIndex < availableWeeks.length - 1 && currentIndex !== -1) {
    currentWeekStart = new Date(availableWeeks[currentIndex + 1]);
    renderWeek();
} else {
    showToast("–ù–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏ —Å –∑–∞–Ω—è—Ç–∏—è–º–∏");
}
}

function goToday() {
const today = new Date(); // –†–µ–∞–ª—å–Ω–∞—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
today.setDate(today.getDate() - ((today.getDay() + 6) % 7)); // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –Ω–µ–¥–µ–ª–∏
const weekKey = wKey(today);
const availableWeeks = getAvailableWeeks();
if (availableWeeks.includes(weekKey)) {
    currentWeekStart = today;
    renderWeek();
} else {
    // –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à—É—é –Ω–µ–¥–µ–ª—é
    const closest = availableWeeks.reduce((prev, curr) => {
        const currDate = new Date(curr);
        const prevDate = new Date(prev);
        return Math.abs(currDate - today) < Math.abs(prevDate - today) ? curr : prev;
    });
    currentWeekStart = new Date(closest);
    renderWeek();
    showToast("–ü–µ—Ä–µ—à–ª–∏ –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –Ω–µ–¥–µ–ª—é —Å –∑–∞–Ω—è—Ç–∏—è–º–∏");
}
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
const originalLoadData = loadData;
loadData = async () => {
await originalLoadData();
cachedLessonsByDate = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫—ç—à
if (document.querySelector('.schedule-tab[data-mode="table"].active')) {
    renderDropdown();
    renderWeek();
}
};

const originalLoadSchedule = loadSchedule;
loadSchedule = async () => {
await originalLoadSchedule();
cachedLessonsByDate = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫—ç—à
if (document.querySelector('.schedule-tab[data-mode="table"].active')) {
    renderDropdown();
    renderWeek();
}
};

// === –ù–û–í–´–ô –†–ê–ë–û–ß–ò–ô –ü–ò–ö–ï–† –í–†–ï–ú–ï–ù–ò (iOS + –ü–ö) ===
let currentEditingField = 'start';

function addOneHour(time) {
let [h, m] = time.split(':').map(Number);
h = (h + 1) % 24;
return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
}

// === –î–ï–°–ö–¢–û–ü: –ò–î–ï–ê–õ–¨–ù–´–ô –í–í–û–î –í–†–ï–ú–ï–ù–ò (2025) ===
// –û—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ + –∫–æ–Ω–µ—Ü —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π + —É–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ +1 —á–∞—Å
if (window.innerWidth >= 768) {
    // –î–ª—è create-lesson-modal
    const checkCreateModal = setInterval(() => {
        const modal = document.getElementById('create-lesson-modal');
        if (!modal || !modal.classList.contains('open')) return;
        clearInterval(checkCreateModal);

        const startBox = document.getElementById('lesson-start-picker');
        const endBox   = document.getElementById('lesson-end-picker');
        if (!startBox || !endBox) return;

        // –°–∫—Ä—ã–≤–∞–µ–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏
        startBox.style.display = 'none';
        endBox.style.display   = 'none';

        let userEditedEnd = false; // —Ñ–ª–∞–≥: —Ç—Ä–æ–≥–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª–µ "–ö–æ–Ω–µ—Ü"

        function normalize(v) {
            v = v.replace(/\D/g, '').slice(0,4);
            if (!v) return '12:00';
            if (v.length <= 2) v += '00';
            if (v.length === 3) v = '0' + v;
            let h = Math.min(23, parseInt(v.slice(0,2)) || 0);
            let m = Math.min(59, parseInt(v.slice(2)) || 0);
            return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
        }

        function addOneHour(t) {
            let [h, m] = t.split(':').map(Number);
            h = (h + 1) % 24;
            return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
        }

        // === –ü–û–õ–ï –ù–ê–ß–ê–õ–û ===
        const startInp = document.createElement('input');
        startInp.type = 'text';
        startInp.className = 'custom-input';
        startInp.placeholder = '12:00';
        startInp.value = '12:00';
        startInp.style.cssText = 'text-align:center;font-size:22px;font-weight:600;margin-top:8px;width:100%;';

        // === –ü–û–õ–ï –ö–û–ù–ï–¶ (—Ç–µ–ø–µ—Ä—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ!) ===
        const endInp = document.createElement('input');
        endInp.type = 'text';
        endInp.className = 'custom-input';
        endInp.placeholder = '13:00';
        endInp.value = '13:00';
        endInp.style.cssText = 'text-align:center;font-size:22px;font-weight:600;margin-top:8px;width:100%;background:#f8f8f8;';

        startBox.parentNode.appendChild(startInp);
        endBox.parentNode.appendChild(endInp);

        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
        startInp.addEventListener('focus', () => {
            if (!userEditedEnd) {
                startInp.value = '';
            }
        });
        endInp.addEventListener('focus', () => {
            endInp.value = '';
            userEditedEnd = true; // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–µ—Ü
        });

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ
        const formatInput = (inp) => {
            let v = inp.value.replace(/\D/g, '').slice(0,4);
            if (v.length >= 3) v = v.slice(0,2) + ':' + v.slice(2);
            inp.value = v;
        };
        startInp.addEventListener('input', () => formatInput(startInp));
        endInp.addEventListener('input', () => formatInput(endInp));

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
        const applyStart = () => {
            const t = normalize(startInp.value || '12:00');
            startInp.value = t;
            startBox.textContent = t;
            document.getElementById('lesson-start-input').value = t;

            // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï —Ç—Ä–æ–≥–∞–ª –∫–æ–Ω–µ—Ü ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º +1 —á–∞—Å
            if (!userEditedEnd) {
                const endT = addOneHour(t);
                endInp.value = endT;
                endBox.textContent = endT;
                document.getElementById('lesson-end-input').value = endT;
            }
        };

        const applyEnd = () => {
            const t = normalize(endInp.value || addOneHour(startInp.value));
            endInp.value = t;
            endBox.textContent = t;
            document.getElementById('lesson-end-input').value = t;
            userEditedEnd = true;
        };

        startInp.addEventListener('blur', applyStart);
        endInp.addEventListener('blur', applyEnd);

        startInp.addEventListener('keydown', e => {
            if (e.key === 'Enter') { applyStart(); startInp.blur(); }
        });
        endInp.addEventListener('keydown', e => {
            if (e.key === 'Enter') { applyEnd(); endInp.blur(); }
        });

        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –Ω–∞—á–∞–ª–æ
        setTimeout(() => startInp.focus(), 100);
    }, 100);

    // –î–ª—è edit-lesson-modal (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)
    const checkEditModal = setInterval(() => {
        const modal = document.getElementById('edit-lesson-modal');
        if (!modal || !modal.classList.contains('open')) return;
        clearInterval(checkEditModal);

        const startBox = document.getElementById('edit-lesson-start-picker');
        const endBox   = document.getElementById('edit-lesson-end-picker');
        if (!startBox || !endBox) return;

        // –°–∫—Ä—ã–≤–∞–µ–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏
        startBox.style.display = 'none';
        endBox.style.display   = 'none';

        let userEditedEnd = false; // —Ñ–ª–∞–≥: —Ç—Ä–æ–≥–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª–µ "–ö–æ–Ω–µ—Ü"

        function normalize(v) {
            v = v.replace(/\D/g, '').slice(0,4);
            if (!v) return '12:00';
            if (v.length <= 2) v += '00';
            if (v.length === 3) v = '0' + v;
            let h = Math.min(23, parseInt(v.slice(0,2)) || 0);
            let m = Math.min(59, parseInt(v.slice(2)) || 0);
            return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
        }

        function addOneHour(t) {
            let [h, m] = t.split(':').map(Number);
            h = (h + 1) % 24;
            return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
        }

        // === –ü–û–õ–ï –ù–ê–ß–ê–õ–û ===
        const startInp = document.createElement('input');
        startInp.type = 'text';
        startInp.className = 'custom-input';
        startInp.placeholder = '12:00';
        startInp.value = document.getElementById('edit-lesson-start-input').value;
        startInp.style.cssText = 'text-align:center;font-size:22px;font-weight:600;margin-top:8px;width:100%;';

        // === –ü–û–õ–ï –ö–û–ù–ï–¶ (—Ç–µ–ø–µ—Ä—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ!) ===
        const endInp = document.createElement('input');
        endInp.type = 'text';
        endInp.className = 'custom-input';
        endInp.placeholder = '13:00';
        endInp.value = document.getElementById('edit-lesson-end-input').value;
        endInp.style.cssText = 'text-align:center;font-size:22px;font-weight:600;margin-top:8px;width:100%;background:#f8f8f8;';

        startBox.parentNode.appendChild(startInp);
        endBox.parentNode.appendChild(endInp);

        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
        startInp.addEventListener('focus', () => {
            if (!userEditedEnd) {
                startInp.value = '';
            }
        });
        endInp.addEventListener('focus', () => {
            endInp.value = '';
            userEditedEnd = true; // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–µ—Ü
        });

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ
        const formatInput = (inp) => {
            let v = inp.value.replace(/\D/g, '').slice(0,4);
            if (v.length >= 3) v = v.slice(0,2) + ':' + v.slice(2);
            inp.value = v;
        };
        startInp.addEventListener('input', () => formatInput(startInp));
        endInp.addEventListener('input', () => formatInput(endInp));

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
        const applyStart = () => {
            const t = normalize(startInp.value || '12:00');
            startInp.value = t;
            startBox.textContent = t;
            document.getElementById('edit-lesson-start-input').value = t;

            // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï —Ç—Ä–æ–≥–∞–ª –∫–æ–Ω–µ—Ü ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º +1 —á–∞—Å
            if (!userEditedEnd) {
                const endT = addOneHour(t);
                endInp.value = endT;
                endBox.textContent = endT;
                document.getElementById('edit-lesson-end-input').value = endT;
            }
        };

        const applyEnd = () => {
            const t = normalize(endInp.value || addOneHour(startInp.value));
            endInp.value = t;
            endBox.textContent = t;
            document.getElementById('edit-lesson-end-input').value = t;
            userEditedEnd = true;
        };

        startInp.addEventListener('blur', applyStart);
        endInp.addEventListener('blur', applyEnd);

        startInp.addEventListener('keydown', e => {
            if (e.key === 'Enter') { applyStart(); startInp.blur(); }
        });
        endInp.addEventListener('keydown', e => {
            if (e.key === 'Enter') { applyEnd(); endInp.blur(); }
        });

        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –Ω–∞—á–∞–ª–æ
        setTimeout(() => startInp.focus(), 100);
    }, 100);
}
// –ú–û–ë–ò–õ–¨–ù–´–ô iOS-–ü–ò–ö–ï–†
else {
    const picker = document.getElementById('mobile-time-picker');

    function initWheels() {
        const h = document.getElementById('tp-hours');
        const m = document.getElementById('tp-minutes');
        h.innerHTML = m.innerHTML = '';
        for (let i = 0; i < 2; i++) { h.innerHTML += '<div></div>'; m.innerHTML += '<div></div>'; }
        for (let i = 0; i < 24; i++) h.innerHTML += `<div>${i.toString().padStart(2,'0')}</div>`;
        for (let i = 0; i < 60; i += 5) m.innerHTML += `<div>${i.toString().padStart(2,'0')}</div>`;
        for (let i = 0; i < 3; i++) { h.innerHTML += '<div></div>'; m.innerHTML += '<div></div>'; }
    }

    function highlight() {
        document.querySelectorAll('.tp-column').forEach(col => {
            const c = col.scrollTop + col.clientHeight / 2;
            col.querySelectorAll('div').forEach(el => {
                el.classList.toggle('selected', Math.abs(el.offsetTop + 28 - c) < 30);
            });
        });
    }

    function snap(col) {
        const h = 56;
        const idx = Math.round(col.scrollTop / h);
        col.scrollTo({ top: idx * h, behavior: 'smooth' });
    }

    function getTime() {
        const h = document.querySelector('#tp-hours .selected')?.textContent || '12';
        const m = document.querySelector('#tp-minutes .selected')?.textContent || '00';
        return `${h}:${m}`;
    }

    function openPicker(field, modalPrefix) {
        currentEditingField = field;
        document.body.classList.add('picker-open');
        picker.classList.add('open');
        initWheels();
        const [h, m] = document.getElementById(`${modalPrefix}-${field}-picker`).textContent.split(':');
        setTimeout(() => {
            const hi = [...document.getElementById('tp-hours').children].findIndex(el => el.textContent === h.padStart(2,'0'));
            const mi = [...document.getElementById('tp-minutes').children].findIndex(el => el.textContent === m.padStart(2,'0'));
            document.getElementById('tp-hours').scrollTop = (hi - 2) * 56;
            document.getElementById('tp-minutes').scrollTop = (mi - 2) * 56;
            highlight();
        }, 100);
    }

    document.querySelectorAll('.tp-column').forEach(col => {
        col.addEventListener('scroll', highlight, { passive: true });
        let t; col.addEventListener('scroll', () => { clearTimeout(t); t = setTimeout(() => snap(col), 100); });
    });

    document.querySelector('.tp-btn.done').onclick = () => {
        const time = getTime();
        const modalPrefix = document.getElementById('create-lesson-modal').classList.contains('open') ? 'lesson' : 'edit-lesson';
        document.getElementById(`${modalPrefix}-${currentEditingField}-picker`).textContent = time;
        document.getElementById(`${modalPrefix}-${currentEditingField}-input`).value = time;
        if (currentEditingField === 'start') {
            const end = addOneHour(time);
            document.getElementById(`${modalPrefix}-end-picker`).textContent = end;
            document.getElementById(`${modalPrefix}-end-input`).value = end;
        }
        picker.classList.remove('open');
        document.body.classList.remove('picker-open');
    };

    document.querySelector('.tp-btn.cancel').onclick = () => {
        picker.classList.remove('open');
        document.body.classList.remove('picker-open');
    };

    document.getElementById('lesson-start-picker').onclick = () => openPicker('start', 'lesson');
    document.getElementById('lesson-end-picker').onclick = () => openPicker('end', 'lesson');
    document.getElementById('edit-lesson-start-picker').onclick = () => openPicker('start', 'edit-lesson');
    document.getElementById('edit-lesson-end-picker').onclick = () => openPicker('end', 'edit-lesson');
}

    

// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞ –∫ "—Å–µ–≥–æ–¥–Ω—è" ‚Äî –ø–ª–∞–≤–Ω–∞—è, –±–µ–∑ –¥—ë—Ä–≥–∞–Ω—å—è
function scrollToToday() {
const todaySection = document.getElementById("today-section");
if (!todaySection) {
    showToast("–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç");
    return;
}

// –í—ã—Å–æ—Ç–∞ sticky-—Ö–µ–¥–µ—Ä–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ: 68px –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ, ~100px –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å gap)
const headerHeight = window.innerWidth < 768 ? 100 : 68;

// –¢–æ—á–Ω—ã–π offset: –ø–æ–∑–∏—Ü–∏—è —Å–µ–∫—Ü–∏–∏ –º–∏–Ω—É—Å –≤—ã—Å–æ—Ç–∞ —Ö–µ–¥–µ—Ä–∞
const offsetTop = todaySection.offsetTop - headerHeight;

// –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –±–µ–∑ overscroll
window.scrollTo({
    top: offsetTop,
    behavior: 'smooth'  // –ù–∞—Ç–∏–≤–Ω–æ –ø–ª–∞–≤–Ω—ã–π –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö
});

// –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫ (–∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ "–°–µ–≥–æ–¥–Ω—è")
todaySection.style.transition = 'all 0.3s ease';
todaySection.style.backgroundColor = 'rgba(52, 199, 89, 0.1)';  // –õ—ë–≥–∫–∏–π –∑–µ–ª—ë–Ω—ã–π —Ö–∞–π–ª–∞–π—Ç
setTimeout(() => {
    todaySection.style.backgroundColor = '';
}, 1000);
}
window.hasScrolledToToday = false; // —Å–±—Ä–æ—Å –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–∂–∏–º–∞
</script>
</body>
</html>